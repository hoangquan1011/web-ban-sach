<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qu·∫£n l√Ω s·∫£n ph·∫©m - Th·ª©c Store</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <style>
    body {
      background-color: #f3f8f3;
      font-family: "Open Sans", sans-serif;
    }

    /* ===================== BANNER ===================== */
    .admin-banner {
      background: url('../img/banner.jpg') center/cover no-repeat;
      height: 220px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      border-radius: 12px;
      margin-bottom: 2rem;
      overflow: hidden;
    }

    /* L·ªõp ph·ªß xanh d·ªãu ƒë·ªÉ tƒÉng ƒë·ªô t∆∞∆°ng ph·∫£n ch·ªØ */
    .admin-banner::after {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0, 80, 40, 0.45);
    }

    .admin-banner h1 {
      color: #ffffff;
      font-weight: 800;
      font-size: 3rem;
      z-index: 2;
      text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.4);
      margin-bottom: 10px;
    }

    .admin-banner p {
      font-size: 1.1rem;
      color: #eafbea;
      z-index: 2;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
    }

    /* ===================== SIDEBAR ===================== */
    .sidebar {
      background-color: #ffffff;
      border-radius: 1rem;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      padding: 1.5rem;
      height: 100%;
    }

    .sidebar h5 {
      color: #2d6a4f;
      font-weight: 700;
      margin-bottom: 1rem;
    }

    .menu-item {
      display: flex;
      align-items: center;
      font-size: 1.1rem;
      color: #2d6a4f;
      font-weight: 600;
      text-decoration: none;
      margin-bottom: 1rem;
      transition: all 0.3s ease;
    }

    .menu-item:hover {
      color: #40916c;
      transform: translateX(5px);
    }

    .menu-item.active {
      color: #1b4332;
      font-weight: 700;
    }

    .menu-item span.emoji {
      font-size: 1.5rem;
      margin-right: 0.75rem;
    }

    /* ===================== CONTENT ===================== */
    .content-area {
      background: #fff;
      border-radius: 1rem;
      box-shadow: 0 3px 8px rgba(0,0,0,0.05);
      padding: 0;
      min-height: 75vh;
    }

    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border: none;
      margin-bottom: 20px;
    }

    .card-header {
      background: white;
      border-bottom: 2px solid #e9ecef;
      padding: 20px;
      border-radius: 10px 10px 0 0 !important;
    }

    .card-title {
      color: #2d6a4f;
      font-weight: bold;
      font-size: 1.2rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Form th√™m s·∫£n ph·∫©m */
    .form-label {
      font-weight: 600;
      color: #495057;
      margin-bottom: 8px;
    }

    .form-control, .form-select, textarea {
      border-radius: 8px;
      border: 1px solid #ced4da;
      padding: 10px 14px;
    }

    .form-control:focus, .form-select:focus, textarea:focus {
      border-color: #2d6a4f;
      box-shadow: 0 0 0 0.2rem rgba(45, 106, 79, 0.15);
    }

    .btn-add-product {
      background: #2d6a4f;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s;
      width: 100%;
    }

    .btn-add-product:hover {
      background: #1b4332;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(45, 106, 79, 0.3);
    }

    /* Filters */
    .filter-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    /* Product Grid */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      padding: 20px;
    }

    .product-card {
      background: white;
      border: 1px solid #e9ecef;
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.3s;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }

    .product-card img {
      width: 100%;
      height: 220px;
      object-fit: cover;
      cursor: pointer;
    }

    .product-card-body {
      padding: 15px;
      cursor: pointer;
    }

    .product-name {
      font-weight: 600;
      font-size: 0.95rem;
      color: #212529;
      margin-bottom: 8px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .product-meta {
      font-size: 0.8rem;
      color: #6c757d;
      margin-bottom: 8px;
    }

    .product-price {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .price-current {
      font-weight: 700;
      color: #dc3545;
      font-size: 1.1rem;
    }

    .price-original {
      text-decoration: line-through;
      color: #6c757d;
      font-size: 0.9rem;
    }

    .discount-badge {
      background: #dc3545;
      color: white;
      padding: 3px 8px;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .product-status {
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .status-visible { color: #28a745; }
    .status-hidden { color: #dc3545; }

    .product-actions {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
    }

    .btn-action {
      padding: 8px 10px;
      border: none;
      border-radius: 6px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }

    .btn-edit {
      background: #4c6b5f;
      color: white;
    }

    .btn-edit:hover {
      background: #3a5447;
    }

    .btn-toggle {
      background: #404A3D;
      color: white;
    }

    .btn-toggle:hover {
      background: #2e352a;
    }

    .btn-delete {
      background: #dc3545;
      color: white;
    }

    .btn-delete:hover {
      background: #c82333;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1050;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      overflow: auto;
    }

    .modal-content {
      background: white;
      margin: 3% auto;
      padding: 0;
      border-radius: 12px;
      width: 600px;
      max-width: 95%;
      max-height: 90vh;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }

    .modal-header {
      background: #2d6a4f;
      color: white;
      padding: 20px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 1.3rem;
    }

    .modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 1.8rem;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s;
    }

    .modal-close:hover {
      background: rgba(255,255,255,0.2);
    }

    .modal-body {
      padding: 25px;
      max-height: calc(90vh - 140px);
      overflow-y: auto;
    }

    .modal-body::-webkit-scrollbar {
      width: 8px;
    }

    .modal-body::-webkit-scrollbar-thumb {
      background: #ccc;
      border-radius: 4px;
    }

    .modal-footer {
      padding: 20px 25px;
      border-top: 1px solid #e9ecef;
      display: flex;
      gap: 10px;
      background: #f8f9fa;
    }

    .btn-modal-save {
      flex: 1;
      background: #2d6a4f;
      color: white;
      border: none;
      padding: 12px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-modal-save:hover {
      background: #1b4332;
    }

    .btn-modal-cancel {
      flex: 1;
      background: #6c757d;
      color: white;
      border: none;
      padding: 12px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-modal-cancel:hover {
      background: #5a6268;
    }

    #editPreview {
      max-width: 150px;
      margin-top: 10px;
      border-radius: 8px;
      border: 2px solid #e9ecef;
    }

    @media (max-width: 768px) {
      .admin-banner h1 {
        font-size: 2rem;
      }

      .product-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
        padding: 15px;
      }
    }
  </style>
</head>

<body>
  <div class="container-fluid py-4">
    <!-- Banner -->
    <div class="admin-banner">
      <h1><i class="fas fa-book"></i> Th·ª©c Store Admin</h1>
      <p>Trang qu·∫£n tr·ªã h·ªá th·ªëng - Qu·∫£n l√Ω S·∫£n ph·∫©m</p>
    </div>

    <div class="row">
      <!-- Sidebar -->
      <div class="col-lg-3 mb-4">
        <div class="sidebar">
          <h5>üìã Menu qu·∫£n l√Ω</h5>
        
          <a href="quanlysanpham.html" class="menu-item active"><span class="emoji">üìò</span> Qu·∫£n l√Ω S·∫£n ph·∫©m</a>
          <a href="quanlydonhang.html" class="menu-item"><span class="emoji">üßæ</span> Qu·∫£n l√Ω ƒê∆°n h√†ng</a>
          <a href="user.html" class="menu-item"><span class="emoji">üë§</span> Qu·∫£n l√Ω Ng∆∞·ªùi d√πng</a>
          <a href="stock.html" class="menu-item"><span class="emoji">üì¶</span> Qu·∫£n l√Ω Kho</a>
          <a href="pricing.html" class="menu-item"><span class="emoji">üí≤</span> Qu·∫£n l√Ω Gi√°</a>
          <a href="import.html" class="menu-item"><span class="emoji">üöö</span> Nh·∫≠p h√†ng</a>
        </div>
      </div>

      <!-- Content -->
      <div class="col-lg-9">
        <div class="content-area">
          <!-- Card Th√™m s·∫£n ph·∫©m -->
          <div class="card">
            <div class="card-header">
              <h5 class="card-title"><i class="fas fa-plus-circle"></i> Th√™m s·∫£n ph·∫©m m·ªõi</h5>
            </div>
            <div class="card-body p-4">
              <form id="addProductForm">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label">Th·ªÉ lo·∫°i</label>
                    <input type="text" class="form-control" id="loai" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">M√£ s·∫£n ph·∫©m</label>
                    <input type="text" class="form-control" id="ma" required>
                  </div>
                  <div class="col-md-12">
                    <label class="form-label">T√™n s√°ch</label>
                    <input type="text" class="form-control" id="ten" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">T√°c gi·∫£</label>
                    <input type="text" class="form-control" id="tacgia" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Nh√† xu·∫•t b·∫£n</label>
                    <input type="text" class="form-control" id="nhaxuatban" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">NƒÉm xu·∫•t b·∫£n</label>
                    <input type="text" class="form-control" id="namxuatban" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">B√¨a s√°ch</label>
                    <input type="file" class="form-control" id="hinh" accept="image/*" required>
                  </div>
                  <div class="col-md-12">
                    <label class="form-label">M√¥ t·∫£</label>
                    <textarea class="form-control" id="mota" rows="3"></textarea>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Gi√° b√°n</label>
                    <input type="number" class="form-control" id="gia" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Gi√° g·ªëc</label>
                    <input type="number" class="form-control" id="giagoc" required>
                  </div>
                </div>
                <button type="submit" class="btn-add-product mt-3">
                  <i class="fas fa-plus"></i> Th√™m s·∫£n ph·∫©m
                </button>
              </form>
            </div>
          </div>

          <!-- Card Danh s√°ch s·∫£n ph·∫©m -->
          <div class="card">
            <div class="card-header">
              <h5 class="card-title"><i class="fas fa-list"></i> Danh s√°ch s·∫£n ph·∫©m</h5>
            </div>
            <div class="card-body">
              <!-- Filters -->
              <div class="filter-section">
                <div class="row g-3">
                  <div class="col-md-5">
                    <input type="text" class="form-control" id="searchInput" placeholder="üîç T√¨m s·∫£n ph·∫©m theo t√™n ho·∫∑c m√£...">
                  </div>
                  <div class="col-md-3">
                    <select class="form-select" id="categoryFilter">
                      <option value="">-- T·∫•t c·∫£ lo·∫°i --</option>
                      <option value="VƒÉn h·ªçc">VƒÉn h·ªçc</option>
                      <option value="Kinh t·∫ø">Kinh t·∫ø</option>
                      <option value="K·ªπ nƒÉng s·ªëng">K·ªπ nƒÉng s·ªëng</option>
                      <option value="Thi·∫øu nhi">Thi·∫øu nhi</option>
                      <option value="Gi√°o khoa">Gi√°o khoa</option>
                    </select>
                  </div>
                  <div class="col-md-4">
                    <select class="form-select" id="priceFilter">
                      <option value="">-- T·∫•t c·∫£ gi√° --</option>
                      <option value="duoi100">D∆∞·ªõi 100.000ƒë</option>
                      <option value="100-200">100k - 200.000ƒë</option>
                      <option value="tren200">Tr√™n 200.000ƒë</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Product Grid -->
              <div class="product-grid" id="productList"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal S·ª≠a s·∫£n ph·∫©m -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-edit"></i> S·ª≠a s·∫£n ph·∫©m</h3>
        <button class="modal-close" id="closeModal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="editForm">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Th·ªÉ lo·∫°i</label>
              <input type="text" class="form-control" id="editLoai">
            </div>
            <div class="col-md-6">
              <label class="form-label">M√£ s·∫£n ph·∫©m</label>
              <input type="text" class="form-control" id="editMa" required>
            </div>
            <div class="col-md-12">
              <label class="form-label">T√™n s√°ch</label>
              <input type="text" class="form-control" id="editTen" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">T√°c gi·∫£</label>
              <input type="text" class="form-control" id="editTacGia">
            </div>
            <div class="col-md-6">
              <label class="form-label">Nh√† xu·∫•t b·∫£n</label>
              <input type="text" class="form-control" id="editNXB">
            </div>
            <div class="col-md-6">
              <label class="form-label">NƒÉm xu·∫•t b·∫£n</label>
              <input type="number" class="form-control" id="editNam">
            </div>
            <div class="col-md-6">
              <label class="form-label">B√¨a s√°ch</label>
              <input type="file" class="form-control" id="editHinh" accept="image/*">
            </div>
            <div class="col-md-12">
              <img id="editPreview" style="display:none;">
            </div>
            <div class="col-md-12">
              <label class="form-label">M√¥ t·∫£</label>
              <textarea class="form-control" id="editMota" rows="3"></textarea>
            </div>
            <div class="col-md-6">
              <label class="form-label">Gi√° b√°n</label>
              <input type="number" class="form-control" id="editGia" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Gi√° g·ªëc</label>
              <input type="number" class="form-control" id="editGiagoc" required>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-modal-save" onclick="document.getElementById('editForm').dispatchEvent(new Event('submit'))">
          <i class="fas fa-save"></i> L∆∞u thay ƒë·ªïi
        </button>
        <button type="button" class="btn-modal-cancel" id="cancelEdit">H·ªßy</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // ‚úÖ Th√™m s·∫£n ph·∫©m
    document.getElementById("addProductForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const fileInput = document.getElementById("hinh").files[0];
      if (!fileInput) {
        alert("Vui l√≤ng ch·ªçn ·∫£nh!");
        return;
      }

      const reader = new FileReader();
      reader.onload = function(event) {
        let product = {
          id: Date.now(), // ‚úÖ QUAN TR·ªåNG: T·∫°o ID duy nh·∫•t
          loai: document.getElementById("loai").value.split(",").map(x => x.trim()),
          ma: document.getElementById("ma").value,
          ten: document.getElementById("ten").value,
          tacgia: document.getElementById("tacgia").value,
          nhaxuatban: document.getElementById("nhaxuatban").value,
          namxuatban: document.getElementById("namxuatban").value,
          hinh: event.target.result,
          mota: document.getElementById("mota").value,
          gia: document.getElementById("gia").value,
          giagoc: document.getElementById("giagoc").value,
          an: false
        };

        let products = JSON.parse(localStorage.getItem("products")) || [];
        products.push(product);
        localStorage.setItem("products", JSON.stringify(products));

        alert("‚úÖ ƒê√£ th√™m s·∫£n ph·∫©m th√†nh c√¥ng!");
        document.getElementById("addProductForm").reset();
        renderProducts();
      };

      reader.readAsDataURL(fileInput);
    });

    // ‚úÖ H√†m xo√° s·∫£n ph·∫©m 
    function deleteProduct(index) {
      let products = JSON.parse(localStorage.getItem("products")) || [];
      if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën xo√° s·∫£n ph·∫©m n√†y?")) {
        products.splice(index, 1);
        localStorage.setItem("products", JSON.stringify(products));
        renderProducts(document.getElementById("searchInput").value);
      }
    }

    // ‚úÖ H√†m ·∫©n/hi·ªán s·∫£n ph·∫©m
    function toggleHide(index) {
      let products = JSON.parse(localStorage.getItem("products")) || [];
      products[index].an = !products[index].an;
      localStorage.setItem("products", JSON.stringify(products));
      renderProducts(document.getElementById("searchInput").value);
    }

    // ‚úÖ B·ªè d·∫•u ti·∫øng Vi·ªát
    function removeAccents(str) {
      return str
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .replace(/ƒë/g, "d")
        .replace(/ƒê/g, "D");
    }

    // ‚úÖ Render danh s√°ch s·∫£n ph·∫©m
    function renderProducts(filter = "") {
      let products = JSON.parse(localStorage.getItem("products")) || [];
      const productList = document.getElementById("productList");
      productList.innerHTML = "";

      let filterText = removeAccents(filter.toLowerCase().trim());
      const category = document.getElementById("categoryFilter")?.value || "";
      const price = document.getElementById("priceFilter")?.value || "";

      products.forEach((p, index) => {
        let ten = removeAccents((p.ten || "").toLowerCase());
        let ma = removeAccents((p.ma || "").toLowerCase());

        if (!(ten.includes(filterText) || ma.includes(filterText))) return;

        let loaiArr = Array.isArray(p.loai) ? p.loai : [p.loai];
        if (category && !loaiArr.some(l => removeAccents(l.toLowerCase()) === removeAccents(category.toLowerCase()))) return;

        let giaNum = parseFloat(p.gia.toString().replace(/\D/g, ""));
        let giagocNum = parseFloat(p.giagoc.toString().replace(/\D/g, ""));

        if (price === "duoi100" && giaNum >= 100000) return;
        if (price === "100-200" && (giaNum < 100000 || giaNum > 200000)) return;
        if (price === "tren200" && giaNum <= 200000) return;

        let giamgia = giagocNum > giaNum ? Math.round(((giagocNum - giaNum) / giagocNum) * 100) : 0;

        const card = document.createElement("div");
        card.classList.add("product-card");

        card.innerHTML = `
          <img src="${p.hinh}" alt="${p.ten}">
          <div class="product-card-body">
            <div class="product-name">${p.ten}</div>
            <div class="product-meta">Lo·∫°i: ${Array.isArray(p.loai) ? p.loai.join(", ") : p.loai} | M√£: ${p.ma}</div>
            <div class="product-price">
              <span class="price-current">${giaNum.toLocaleString()}ƒë</span>
              ${giagocNum > giaNum ? `<span class="price-original">${giagocNum.toLocaleString()}ƒë</span>` : ""}
            </div>
            ${giamgia > 0 ? `<div class="discount-badge">-${giamgia}%</div>` : ""}
            <div class="product-status ${p.an ? 'status-hidden' : 'status-visible'}">
              <i class="fas fa-circle"></i> ${p.an ? "ƒêang ·∫©n" : "ƒêang hi·ªÉn th·ªã"}
            </div>
          </div>
          <div class="product-actions">
            <button class="btn-action btn-edit" onclick="openEditModal(${index})">
              <i class="fas fa-edit"></i> S·ª≠a
            </button>
            <button class="btn-action btn-toggle" onclick="toggleHide(${index})">
              <i class="fas fa-eye${p.an ? '-slash' : ''}"></i> ${p.an ? "Hi·ªán" : "·∫®n"}
            </button>
            <button class="btn-action btn-delete" onclick="deleteProduct(${index})">
              <i class="fas fa-trash"></i> X√≥a
            </button>
          </div>
        `;

        card.querySelector("img").addEventListener("click", () => {
          localStorage.setItem("selectedProduct", JSON.stringify(p));
          window.location.href = "chitiet.html";
        });

        card.querySelector(".product-card-body").addEventListener("click", () => {
          localStorage.setItem("selectedProduct", JSON.stringify(p));
          window.location.href = "chitiet.html";
        });

        productList.appendChild(card);
      });
    }

    // ‚úÖ G·∫Øn s·ª± ki·ªán t√¨m ki·∫øm v√† l·ªçc
    document.getElementById("searchInput").addEventListener("input", function() {
      renderProducts(this.value);
    });

    document.getElementById("categoryFilter").addEventListener("change", () => {
      renderProducts(document.getElementById("searchInput").value);
    });

    document.getElementById("priceFilter").addEventListener("change", () => {
      renderProducts(document.getElementById("searchInput").value);
    });

    // ‚úÖ Modal Edit
    let editIndex = null;

    function openEditModal(index) {
      const products = JSON.parse(localStorage.getItem("products")) || [];
      const product = products[index];
      if (!product) return;

      editIndex = index;

      document.getElementById("editLoai").value = Array.isArray(product.loai) ? product.loai.join(", ") : product.loai || "";
      document.getElementById("editMa").value = product.ma || "";
      document.getElementById("editTen").value = product.ten || "";
      document.getElementById("editTacGia").value = product.tacgia || "";
      document.getElementById("editNXB").value = product.nhaxuatban || "";
      document.getElementById("editNam").value = product.namxuatban || "";
      document.getElementById("editMota").value = product.mota || "";
      document.getElementById("editGia").value = product.gia || "";
      document.getElementById("editGiagoc").value = product.giagoc || "";
      document.getElementById("editPreview").src = product.hinh || "";
      document.getElementById("editPreview").style.display = product.hinh ? "block" : "none";

      document.getElementById("editModal").style.display = "block";
    }

    function closeEditModal() {
      document.getElementById("editModal").style.display = "none";
      editIndex = null;
    }

    document.addEventListener("DOMContentLoaded", function () {
      document.getElementById("closeModal").addEventListener("click", closeEditModal);
      document.getElementById("cancelEdit").addEventListener("click", closeEditModal);

      window.addEventListener("click", function(e) {
        const modal = document.getElementById("editModal");
        if (e.target === modal) {
          closeEditModal();
        }
      });

      document.getElementById("editHinh").addEventListener("change", function() {
        const file = this.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = e => {
            document.getElementById("editPreview").src = e.target.result;
            document.getElementById("editPreview").style.display = "block";
          };
          reader.readAsDataURL(file);
        }
      });

      document.getElementById("editForm").addEventListener("submit", function(e) {
        e.preventDefault();
        let products = JSON.parse(localStorage.getItem("products")) || [];
        if (editIndex === null || !products[editIndex]) return;

        const loai = document.getElementById("editLoai").value.split(",").map(l => l.trim()).filter(Boolean);
        const ma = document.getElementById("editMa").value.trim();
        const ten = document.getElementById("editTen").value.trim();
        const tacgia = document.getElementById("editTacGia").value.trim();
        const nhaxuatban = document.getElementById("editNXB").value.trim();
        const namxuatban = document.getElementById("editNam").value.trim();
        const mota = document.getElementById("editMota").value.trim();
        const gia = document.getElementById("editGia").value.trim();
        const giagoc = document.getElementById("editGiagoc").value.trim();
        const file = document.getElementById("editHinh").files[0];

        if (!ma || !ten || !gia || !giagoc || !tacgia || !namxuatban || !nhaxuatban) {
          alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
          return;
        }

        const saveProduct = (img) => {
          products[editIndex] = {
            ...products[editIndex],
            loai, ma, ten, mota,
            gia, giagoc, tacgia, nhaxuatban, namxuatban,
            hinh: img || products[editIndex].hinh
          };
          localStorage.setItem("products", JSON.stringify(products));
          
          const selected = JSON.parse(localStorage.getItem("selectedProduct"));
          if (selected && selected.ma === ma) {
            localStorage.setItem("selectedProduct", JSON.stringify(products[editIndex]));
          }
          
          alert("‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng!");
          closeEditModal();
          renderProducts(document.getElementById("searchInput").value);
        };

        if (file) {
          const reader = new FileReader();
          reader.onload = e => saveProduct(e.target.result);
          reader.readAsDataURL(file);
        } else {
          saveProduct();
        }
      });
    });

    // ‚úÖ Render ban ƒë·∫ßu
    renderProducts();
  </script>
</body>
</html>