<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qu·∫£n l√Ω kh√°ch h√†ng - Th·ª©c Store</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <style>
    body { background-color: #f3f8f3; font-family: "Open Sans", sans-serif; }

    .admin-banner{
      background:url('../img/banner.jpg') center/cover no-repeat;height:220px;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      position:relative;border-radius:12px;margin-bottom:2rem;overflow:hidden
    }
    .admin-banner::after{content:"";position:absolute;inset:0;background:rgba(0,80,40,.45)}
    .admin-banner h1{color:#fff;font-weight:800;font-size:3rem;z-index:2}
    .admin-banner p{color:#eafbea;font-size:1.1rem;z-index:2}

    .sidebar{background:#fff;border-radius:1rem;box-shadow:0 3px 10px rgba(0,0,0,.1);padding:1.5rem;height:100%}
    .sidebar h5{color:#2d6a4f;font-weight:700;margin-bottom:1rem}
    .menu-item{display:flex;align-items:center;color:#2d6a4f;font-weight:600;text-decoration:none;margin-bottom:1rem;transition:.3s}
    .menu-item:hover{color:#40916c;transform:translateX(5px)}
    .menu-item.active{color:#1b4332;font-weight:700}
    .menu-item span.emoji{font-size:1.5rem;margin-right:.75rem}

    .content-area{background:#fff;border-radius:1rem;box-shadow:0 3px 8px rgba(0,0,0,.05);padding:0;min-height:75vh}
    table th,table td{vertical-align:middle;font-size:14px}
    .pw-mask{font-family:monospace;letter-spacing:2px}

    .status-active{background:#ecfdf5;color:#065f46;border-radius:999px;padding:3px 8px;font-size:12px}
    .status-locked{background:#fff7f7;color:#7f1d1d;border-radius:999px;padding:3px 8px;font-size:12px}

    .btn-sm{font-size:13px;padding:4px 8px}
    footer{text-align:center;padding:20px;font-size:14px;color:#6c757d}

    .modal-backdrop-custom{position:fixed;inset:0;background:rgba(2,6,23,.35);display:none;align-items:center;justify-content:center;z-index:1050}
    .modal-inner{background:#fff;padding:20px;border-radius:12px;width:800px;max-width:95%}
  </style>
</head>
<body>
  <div class="container-fluid py-4">
    <div class="admin-banner">
      <h1><i class="fas fa-users"></i> Qu·∫£n l√Ω kh√°ch h√†ng</h1>
      <p>Trang qu·∫£n tr·ªã h·ªá th·ªëng - Qu·∫£n l√Ω Ng∆∞·ªùi d√πng</p>
    </div>

    <div class="row">
      <div class="col-lg-3 mb-4">
        <div class="sidebar">
          <h5>üìã Menu qu·∫£n l√Ω</h5>
          <a href="quanlysanpham.html" class="menu-item"><span class="emoji">üìò</span> Qu·∫£n l√Ω S·∫£n ph·∫©m</a>
          <a href="quanlydonhang.html" class="menu-item"><span class="emoji">üßæ</span> Qu·∫£n l√Ω ƒê∆°n h√†ng</a>
          <a href="user.html" class="menu-item active"><span class="emoji">üë§</span> Qu·∫£n l√Ω Ng∆∞·ªùi d√πng</a>
          <a href="stock.html" class="menu-item"><span class="emoji">üì¶</span> Qu·∫£n l√Ω Kho</a>
          <a href="pricing.html" class="menu-item"><span class="emoji">üí≤</span> Qu·∫£n l√Ω Gi√°</a>
          <a href="import.html" class="menu-item"><span class="emoji">üöö</span> Nh·∫≠p h√†ng</a>
        </div>
      </div>

      <div class="col-lg-9">
        <div class="content-area p-4">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <input id="search" class="form-control w-50" placeholder="üîç T√¨m kh√°ch h√†ng...">
            <div class="d-flex gap-2">
              <button class="btn btn-outline-success" id="clearSearch">X√≥a</button>
              <button class="btn btn-success" id="openAdd"><i class="fas fa-user-plus"></i> Th√™m</button>
            </div>
          </div>

          <table class="table table-bordered align-middle">
            <thead>
              <tr>
                <th>H·ªç & t√™n</th>
                <th>Email</th>
                <th>ƒêi·ªán tho·∫°i</th>
                <th>Th√†nh ph·ªë</th>
                <th>T√†i kho·∫£n</th>
                <th>M·∫≠t kh·∫©u</th>
                <th>Ngu·ªìn</th>
                <th>Tr·∫°ng th√°i</th>
                <th>Thao t√°c</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <footer>¬© 2025 Th·ª©c Store Admin ‚Äì All rights reserved.</footer>

  <!-- Modal th√™m/s·ª≠a -->
  <div class="modal-backdrop-custom" id="modalBackdrop">
    <div class="modal-inner">
      <h4 id="modalTitle" class="text-success mb-3">Th√™m kh√°ch h√†ng</h4>
      <div class="row g-3">
        <div class="col-md-6"><label>H·ªç & t√™n</label><input id="name" class="form-control"></div>
        <div class="col-md-6"><label>Email</label><input id="email" class="form-control" type="email"></div>
        <div class="col-md-6"><label>ƒêi·ªán tho·∫°i</label><input id="phone" class="form-control"></div>
        <div class="col-md-6"><label>Th√†nh ph·ªë</label><input id="city" class="form-control"></div>
        <div class="col-md-6"><label>T√†i kho·∫£n</label><input id="username" class="form-control"></div>
        <div class="col-md-6"><label>M·∫≠t kh·∫©u</label><input id="password" class="form-control" type="password"></div>
        <div class="col-md-6">
          <label>Tr·∫°ng th√°i</label>
          <select id="status" class="form-select">
            <option value="active">Active</option>
            <option value="locked">Locked</option>
          </select>
        </div>
      </div>
      <div class="text-end mt-4">
        <button class="btn btn-secondary" id="cancel">H·ªßy</button>
        <button class="btn btn-success" id="saveBtn">L∆∞u</button>
      </div>
    </div>
  </div>

  <script>
    // D√πng chung d·ªØ li·ªáu users
    let data = JSON.parse(localStorage.getItem('users') || '[]');

    const tbody = document.getElementById('tbody');
    const modal = document.getElementById('modalBackdrop');
    let editingId = null;

    function maskPw(pw){ return '‚óè'.repeat(Math.min((pw||'').length, 8)); }

    function persist(){ localStorage.setItem('users', JSON.stringify(data)); }

    function render(){
      tbody.innerHTML='';
      const q = document.getElementById('search').value.trim().toLowerCase();

      data
        .filter(c => !q || (c.name + c.email + c.phone + c.city + c.username).toLowerCase().includes(q))
        .forEach(c => {
          const isActive = (c.status || 'active') === 'active';
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${c.name || ''}</td>
            <td>${c.email || ''}</td>
            <td>${c.phone || ''}</td>
            <td>${c.city || '-'}</td>
            <td>${c.username || ''}</td>
            <td>
              <span id="pw-${c.id}" class="pw-mask" data-show="0">${maskPw(c.password||'')}</span>
              <button class="btn btn-sm btn-outline-secondary ms-1" onclick="togglePw(${c.id})">Hi·ªán/·∫®n</button>
            </td>
            <td>${c.createdBy || 'admin'}</td>
            <td><span class="${isActive ? 'status-active' : 'status-locked'}">${isActive ? 'active' : 'locked'}</span></td>
            <td class="d-flex gap-1 flex-wrap">
              <button class="btn btn-sm ${isActive ? 'btn-outline-warning' : 'btn-outline-success'}" onclick="toggleLock(${c.id})">
                <i class="fa-solid ${isActive ? 'fa-lock' : 'fa-unlock'}"></i> ${isActive ? 'Kh√≥a' : 'M·ªü kh√≥a'}
              </button>
              <button class="btn btn-sm btn-outline-primary" onclick="openEdit(${c.id})"><i class="fa fa-pen"></i> S·ª≠a</button>
              <button class="btn btn-sm btn-outline-danger" onclick="removeUser(${c.id})"><i class="fa fa-trash"></i> X√≥a</button>
            </td>
          `;
          tbody.appendChild(tr);
        });

      persist();
    }

    // === H√†nh ƒë·ªông h√†ng ===
    window.togglePw = function(id){
      const span = document.getElementById(`pw-${id}`);
      const u = data.find(x => x.id === id);
      if(!span || !u) return;
      if(span.dataset.show === '1'){
        span.textContent = maskPw(u.password || '');
        span.dataset.show = '0';
      }else{
        span.textContent = u.password || '';
        span.dataset.show = '1';
      }
    };

    window.toggleLock = function(id){
      const idx = data.findIndex(x => x.id === id);
      if(idx < 0) return;
      data[idx].status = (data[idx].status === 'locked') ? 'active' : 'locked';
      render();
    };

    window.removeUser = function(id){
      if(!confirm('X√≥a kh√°ch h√†ng n√†y?')) return;
      data = data.filter(x => x.id !== id);
      render();
    };

    // === Modal th√™m/s·ª≠a ===
    function openEdit(id){
      const u = data.find(x => x.id === id);
      if(!u) return;
      editingId = id;
      document.getElementById('modalTitle').textContent = 'S·ª≠a kh√°ch h√†ng';
      ['name','email','phone','city','username','password','status'].forEach(f => {
        document.getElementById(f).value = u[f] || '';
      });
      modal.style.display='flex';
    }

    document.getElementById('openAdd').addEventListener('click',()=>{
      editingId=null;
      document.getElementById('modalTitle').textContent='Th√™m kh√°ch h√†ng';
      ['name','email','phone','city','username','password'].forEach(id=>document.getElementById(id).value='');
      document.getElementById('status').value='active';
      modal.style.display='flex';
    });

    document.getElementById('cancel').addEventListener('click',()=>modal.style.display='none');
    modal.addEventListener('click',e=>{ if(e.target===modal) modal.style.display='none'; });

    document.getElementById('saveBtn').addEventListener('click',()=>{
      const fields = ['name','email','phone','city','username','password','status'];
      const vals = {};
      fields.forEach(f=>vals[f] = document.getElementById(f).value.trim());

      if(editingId){
        const idx = data.findIndex(x=>x.id===editingId);
        if(idx>=0) data[idx] = { ...data[idx], ...vals };
      }else{
        data.push({ ...vals, id: Date.now(), createdBy: 'admin' });
      }
      modal.style.display='none';
      render();
    });

    // === T√¨m ki·∫øm ===
    document.getElementById('search').addEventListener('input',render);
    document.getElementById('clearSearch').addEventListener('click',()=>{document.getElementById('search').value='';render();});

    // Kh·ªüi t·∫°o
    render();
  </script>
</body>
</html>
