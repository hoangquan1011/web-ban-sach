<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin - Kho | Th·ª©c Store</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/admin-shared.css">

  <style>
    body { background:#f3f8f3; font-family:"Open Sans",sans-serif; }
    .content-area{ background:#fff; padding:1.5rem; border-radius:1rem; box-shadow:0 3px 8px rgba(0,0,0,0.04); min-height:65vh; }
    .card { border:none; box-shadow:0 3px 12px rgba(0,0,0,0.05); border-radius:1rem; }
    .card-header { border-bottom:1px solid #edf2ef; background:#f9fffb; border-radius:1rem 1rem 0 0 !important; }
    .table thead { background:#f5f8f6; color:#2d6a4f; font-weight:600; }
    .sku-pill { font-weight:600; color:#1b4332; }
    .badge-cat { background:#ecfdf5; color:#065f46; border-radius:999px; padding:2px 8px; font-size:.8rem; }
    .text-muted-small { font-size:.9rem; color:#6c757d; }

  </style>
</head>
<body>
  <div class="container-fluid py-4">
    <div class="admin-banner">
      <div class="text-center">
        <h1 class="h2 fw-bold">Th·ª©c Store Admin</h1>
        <div class="small">Ki·ªÉm tra t·ªìn kho</div>
      </div>
    </div>

     <div class="row">
      <!-- Sidebar -->
      <div class="col-lg-3 mb-4">
        <div class="sidebar">
          <h5>üìã Menu qu·∫£n l√Ω</h5>
        
          <a href="quanlysanpham.html" class="menu-item"><span class="emoji">üìò</span> Qu·∫£n l√Ω S·∫£n ph·∫©m</a>
          <a href="quanlydonhang.html" class="menu-item"><span class="emoji">üßæ</span> Qu·∫£n l√Ω ƒê∆°n h√†ng</a>
          <a href="user.html" class="menu-item"><span class="emoji">üë§</span> Qu·∫£n l√Ω Ng∆∞·ªùi d√πng</a>
          <a href="stock.html" class="menu-item active"><span class="emoji">üì¶</span> Qu·∫£n l√Ω Kho</a>
          <a href="pricing.html" class="menu-item"><span class="emoji">üí≤</span> Qu·∫£n l√Ω Gi√°</a>
          <a href="import.html" class="menu-item"><span class="emoji">üöö</span> Nh·∫≠p h√†ng</a>
        </div>
      </div>

      <div class="col-lg-9">
        <div class="content-area">
          <div class="d-flex flex-column flex-md-row justify-content-between gap-2 align-items-md-center mb-3">
            <div>
              <h4 class="text-success mb-1">Qu·∫£n l√Ω Kho - Danh s√°ch s·∫£n ph·∫©m</h4>
      
            </div>
            
          </div>

          <div class="card mb-4">
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-5">
                  <label class="form-label">T√¨m ki·∫øm (t√™n ho·∫∑c m√£ s·∫£n ph·∫©m)</label>
                  <input id="searchInput" class="form-control" placeholder="V√≠ d·ª•: ƒê·∫Øc Nh√¢n T√¢m / VH001">
                </div>
                <div class="col-md-4">
                  <label class="form-label">L·ªçc theo nh√≥m</label>
                  <select id="categoryFilter" class="form-select">
                    <option value="">-- T·∫•t c·∫£ lo·∫°i --</option>
                  </select>
                </div>
               
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header d-flex justify-content-between flex-wrap gap-2 align-items-center">
              <h5 class="mb-0 text-success"><i class="fa-solid fa-boxes-stacked me-2"></i>Danh s√°ch t·ªìn kho</h5>
              <span id="listSummary" class="text-muted-small">0 s·∫£n ph·∫©m</span>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover align-middle">
                  <thead>
                    <tr>
                      <th style="min-width: 120px;">M√£</th>
                      <th>T√™n s·∫£n ph·∫©m</th>
                      <th style="min-width: 150px;">Lo·∫°i</th>
                      <th style="width: 90px;">T·ªìn</th>
                      <th style="min-width: 140px;">Gi√° b√°n</th>
                      <th style="min-width: 160px;">Ghi ch√∫</th>
                    </tr>
                  </thead>
                  <tbody id="stockTable">
                    <tr>
                      <td colspan="6" class="text-center text-muted">ƒêang t·∫£i d·ªØ li·ªáu...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const fallbackProducts = [
        { ma: 'VH001', ten: 'ƒê·∫Øc Nh√¢n T√¢m', loai: ['VƒÉn h·ªçc'], gia: 86000, stock: 120 },
        { ma: 'VH002', ten: 'Nh√† Gi·∫£ Kim', loai: ['VƒÉn h·ªçc'], gia: 72000, stock: 80 },
        { ma: 'KT001', ten: 'T∆∞ Duy ƒê·∫ßu T∆∞', loai: ['Kinh t·∫ø'], gia: 130000, stock: 60 },
        { ma: 'KT002', ten: 'The Little Book', loai: ['Kinh t·∫ø'], gia: 150000, stock: 40 },
        { ma: 'TN001', ten: 'D·∫ø M√®n Phi√™u L∆∞u K√Ω', loai: ['Thi·∫øu nhi'], gia: 55000, stock: 150 }
      ];

      const refs = {
        search: document.getElementById('searchInput'),
        category: document.getElementById('categoryFilter'),
        source: document.getElementById('sourceFilter'),
        table: document.getElementById('stockTable'),
        summary: document.getElementById('listSummary')
      };

      const getStoredProducts = () => JSON.parse(localStorage.getItem('products') || '[]');

      const getProducts = () => {
        const stored = getStoredProducts();
        return refs.source?.value === 'fallback'
          ? [...fallbackProducts]
          : refs.source?.value === 'products'
            ? (stored.length ? stored : [])
            : (stored.length ? stored : fallbackProducts);
      };

      const formatCurrency = (val) =>
        Number(val || 0).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' }).replace('‚Ç´', 'ƒë');

      const normalizeCategories = (p) => {
        if (Array.isArray(p.loai)) return p.loai.filter(Boolean);
        if (typeof p.loai === 'string' && p.loai.trim()) return p.loai.split(',').map((c) => c.trim()).filter(Boolean);
        return [];
      };

      const populateCategoryOptions = (products) => {
        if (!refs.category) return;
        const cats = new Set();
        products.forEach((p) => normalizeCategories(p).forEach((cat) => cats.add(cat)));

        const current = refs.category.value;
        refs.category.innerHTML = '<option value="">-- T·∫•t c·∫£ lo·∫°i --</option>';
        Array.from(cats).sort().forEach((cat) => {
          const option = document.createElement('option');
          option.value = cat;
          option.textContent = cat;
          refs.category.appendChild(option);
        });
        if (current && cats.has(current)) refs.category.value = current;
      };

      const renderTable = () => {
        if (!refs.table) return;
        const searchTerm = refs.search?.value?.trim().toLowerCase() || '';
        const selectedCat = refs.category?.value || '';
        const products = getProducts();

        populateCategoryOptions(products);

        const filtered = products.filter((p) => {
          const name = (p.ten || p.title || '').toLowerCase();
          const sku = (p.ma || p.id || '').toLowerCase();
          const matchesSearch = !searchTerm || name.includes(searchTerm) || sku.includes(searchTerm);
          const cats = normalizeCategories(p);
          const matchesCategory = !selectedCat || cats.includes(selectedCat);
          return matchesSearch && matchesCategory;
        });

        if (refs.summary) refs.summary.textContent = `${filtered.length} s·∫£n ph·∫©m`;

        if (!filtered.length) {
          refs.table.innerHTML = '<tr><td colspan="6" class="text-center text-muted">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m ph√π h·ª£p.</td></tr>';
          return;
        }

        refs.table.innerHTML = filtered
          .map((p) => {
            const cats = normalizeCategories(p);
            const badgeCats = cats.length ? cats.map((cat) => `<span class="badge-cat me-1">${cat}</span>`).join('') : '<span class="text-muted">‚Äî</span>';
            return `
              <tr>
                <td><span class="sku-pill">${p.ma || p.id || 'N/A'}</span></td>
                <td>${p.ten || p.title || 'Ch∆∞a ƒë·∫∑t t√™n'}</td>
                <td>${badgeCats}</td>
                <td>${Number(p.stock || 0)}</td>
                <td>${formatCurrency(p.gia || p.price || 0)}</td>
                <td>${p.nhaxuatban || p.supplier || '<span class="text-muted">Kh√¥ng c√≥ ghi ch√∫</span>'}</td>
              </tr>
            `;
          })
          .join('');
      };

      refs.search?.addEventListener('input', () => renderTable());
      refs.category?.addEventListener('change', () => renderTable());
      refs.source?.addEventListener('change', () => renderTable());

      renderTable();
    });
  </script>
</body>
</html>
