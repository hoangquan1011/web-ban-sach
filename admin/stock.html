<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin - Kho | Th·ª©c Store</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/admin-shared.css">

  <style>
    body { background:#f3f8f3; font-family:"Open Sans",sans-serif; }
    .content-area{ background:#fff; padding:1.5rem; border-radius:1rem; box-shadow:0 3px 8px rgba(0,0,0,0.04); min-height:65vh; }
    .card { border:none; box-shadow:0 3px 12px rgba(0,0,0,0.05); border-radius:1rem; }
    .card-header { border-bottom:1px solid #edf2ef; background:#f9fffb; border-radius:1rem 1rem 0 0 !important; }
    .table thead { background:#f5f8f6; color:#2d6a4f; font-weight:600; }
    .sku-pill { font-weight:600; color:#1b4332; }
    .badge-cat { background:#ecfdf5; color:#065f46; border-radius:999px; padding:2px 8px; font-size:.8rem; }
    .text-muted-small { font-size:.9rem; color:#6c757d; }
    
    /* Th√™m style cho t·ªìn kho */
    .stock-badge {
      display: inline-block;
      font-size: 1.1rem;
      font-weight: 800;
      padding: 0.4rem 0.9rem;
      border-radius: 0.5rem;
      min-width: 50px;
      text-align: center;
    }
    
    .stock-high {
      background: #d1f4e0;
      color: #0f5132;
      border: 2px solid #52b788;
    }
    
    .stock-medium {
      background: #fff3cd;
      color: #997404;
      border: 2px solid #ffc107;
    }
    
    .stock-low {
      background: #f8d7da;
      color: #842029;
      border: 2px solid #dc3545;
    }
    
    .price-original {
      text-decoration: line-through;
      color: #95a5a6;
      font-size: 0.85rem;
      display: block;
      margin-top: 0.2rem;
    }
  </style>
</head>
<body>
  <div class="container-fluid py-4">
    <div class="admin-banner">
      <div class="text-center">
        <h1 class="h2 fw-bold">Th·ª©c Store Admin</h1>
        <div class="small">Ki·ªÉm tra t·ªìn kho</div>
      </div>
    </div>

     <div class="row">
      <!-- Sidebar -->
      <div class="col-lg-3 mb-4">
        <div class="sidebar">
          <h5>üìã Menu qu·∫£n l√Ω</h5>
        
          <a href="quanlysanpham.html" class="menu-item"><span class="emoji">üìò</span> Qu·∫£n l√Ω S·∫£n ph·∫©m</a>
          <a href="quanlydonhang.html" class="menu-item"><span class="emoji">üßæ</span> Qu·∫£n l√Ω ƒê∆°n h√†ng</a>
          <a href="user.html" class="menu-item"><span class="emoji">üë§</span> Qu·∫£n l√Ω Ng∆∞·ªùi d√πng</a>
          <a href="stock.html" class="menu-item active"><span class="emoji">üì¶</span> Qu·∫£n l√Ω Kho</a>
          <a href="pricing.html" class="menu-item"><span class="emoji">üí≤</span> Qu·∫£n l√Ω Gi√°</a>
          <a href="import.html" class="menu-item"><span class="emoji">üöö</span> Nh·∫≠p h√†ng</a>
        </div>
      </div>

      <div class="col-lg-9">
        <div class="content-area">
          <div class="d-flex flex-column flex-md-row justify-content-between gap-2 align-items-md-center mb-3">
            <div>
              <h4 class="text-success mb-1">Qu·∫£n l√Ω Kho - Danh s√°ch s·∫£n ph·∫©m</h4>
            </div>
          </div>

          <div class="card mb-4">
            <div class="card-body">
              <div class="row g-3 align-items-end">
                <div class="col-md-5">
                  <label class="form-label">T√¨m ki·∫øm (t√™n ho·∫∑c m√£ s·∫£n ph·∫©m)</label>
                  <input id="searchInput" class="form-control" placeholder="V√≠ d·ª•: ƒê·∫Øc Nh√¢n T√¢m / VH001">
                </div>
                <div class="col-md-4">
                  <label class="form-label">L·ªçc theo nh√≥m</label>
                  <select id="categoryFilter" class="form-select">
                    <option value="">-- T·∫•t c·∫£ lo·∫°i --</option>
                    <option value="K·ªπ nƒÉng s·ªëng">K·ªπ nƒÉng s·ªëng</option>
                    <option value="Thi·∫øu nhi">Thi·∫øu nhi</option>
                    <option value="VƒÉn h·ªçc">VƒÉn h·ªçc</option>
                    <option value="Kinh t·∫ø">Kinh t·∫ø</option>
                    <option value="Gi√°o khoa">Gi√°o khoa</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label class="form-label">T·ª´ ng√†y c·∫≠p nh·∫≠t</label>
                  <input type="date" id="stockDateFrom" class="form-control">
                </div>
                <div class="col-md-3">
                  <label class="form-label">ƒê·∫øn ng√†y</label>
                  <input type="date" id="stockDateTo" class="form-control">
                </div>
                <div class="col-md-2">
                  <button id="stockFilterBtn" class="btn btn-success w-100">
                    <i class="fa fa-filter me-1"></i>L·ªçc
                  </button>
                </div>
                <div class="col-md-2">
                  <button id="stockResetBtn" class="btn btn-outline-secondary w-100">
                    <i class="fa fa-redo me-1"></i>ƒê·∫∑t l·∫°i
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header d-flex justify-content-between flex-wrap gap-2 align-items-center">
              <h5 class="mb-0 text-success"><i class="fa-solid fa-boxes-stacked me-2"></i>Danh s√°ch t·ªìn kho</h5>
              <span id="stockSummary" class="text-muted-small">0 s·∫£n ph·∫©m</span>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover align-middle">
                  <thead>
                    <tr>
                      <th style="min-width: 120px;">M√£</th>
                      <th>T√™n s·∫£n ph·∫©m</th>
                      <th style="min-width: 150px;">Lo·∫°i</th>
                      <th style="width: 90px;">T·ªìn</th>
                      <th style="min-width: 140px;">Gi√° b√°n</th>
                      <th style="min-width: 140px;">Ng√†y c·∫≠p nh·∫≠t</th>
                      <th style="min-width: 160px;">Ghi ch√∫</th>
                    </tr>
                  </thead>
                  <tbody id="stockTable">
                    <tr>
                      <td colspan="7" class="text-center text-muted">ƒêang t·∫£i d·ªØ li·ªáu...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const stockItems = [
      { code: 'KN001', name: 'GOOD ENERGY - NƒÇNG L∆Ø·ª¢NG T·ªêT', category: 'K·ªπ nƒÉng s·ªëng', stock: 68, price: 85000, originalPrice: 120000, note: 'First News', lastUpdated: '2025-02-12' },
      { code: 'KN002', name: 'NGH·ªÜ THU·∫¨T T∆Ø DUY LOGIC', category: 'K·ªπ nƒÉng s·ªëng', stock: 42, price: 126000, originalPrice: 169000, note: 'Th√°i H√† Books', lastUpdated: '2025-02-10' },
      { code: 'KN003', name: 'K·ª∏ NƒÇNG T∆Ø DUY TH·ª∞C CHI·∫æN', category: 'K·ªπ nƒÉng s·ªëng', stock: 95, price: 126000, originalPrice: 169000, note: 'Alphabooks', lastUpdated: '2025-02-06' },
      { code: 'TN001', name: 'THI√äN NHI√äN - T·∫†I SAO CH√öNG TA C·∫¶N THI√äN NHI√äN XANH T∆Ø∆†I?', category: 'Thi·∫øu nhi', stock: 156, price: 52000, originalPrice: 70000, note: 'Kim ƒê·ªìng', lastUpdated: '2025-02-08' },
      { code: 'TN002', name: 'G·ª¢I M·ªû TR√ç T∆Ø·ªûNG T∆Ø·ª¢NG - N·ªñI BU·ªíN C·ª¶A C√ÇY √çCH K·ª∂', category: 'Thi·∫øu nhi', stock: 128, price: 28000, originalPrice: 35000, note: 'D√¢n Tr√≠', lastUpdated: '2025-02-09' },
      { code: 'TN003', name: 'R√àN TR√ç TH√îNG MINH - T·∫¨P 3', category: 'Thi·∫øu nhi', stock: 183, price: 24000, originalPrice: 30000, note: 'Kim ƒê·ªìng', lastUpdated: '2025-02-11' },
      { code: 'VN001', name: 'RU·ªíI TR√ÇU (T√ÅI B·∫¢N NƒÇM 2018)', category: 'VƒÉn h·ªçc', stock: 74, price: 96000, originalPrice: 128000, note: 'NXB VƒÉn H·ªçc', lastUpdated: '2025-02-05' },
      { code: 'VH002', name: 'VƒÇN H·ªåC KINH ƒêI·ªÇN - L·ªÄ TH√ìI TH·ªä TH√ÄNH', category: 'VƒÉn h·ªçc', stock: 38, price: 164000, originalPrice: 205000, note: 'NXB VƒÉn H·ªçc', lastUpdated: '2025-02-03' },
      { code: 'VH003', name: 'VƒÇN H·ªåC KINH ƒêI·ªÇN - CH√ÇN DUNG M·ªòT CU·ªòC H√îN NH√ÇN', category: 'VƒÉn h·ªçc', stock: 29, price: 215000, originalPrice: 225000, note: 'NXB H·ªôi Nh√† VƒÉn', lastUpdated: '2025-02-02' },
      { code: 'KT001', name: 'THE LITTLE BOOK - ƒê·∫¶U T∆Ø THEO CHI·∫æN L∆Ø·ª¢C PH√íNG TH·ª¶', category: 'Kinh t·∫ø', stock: 56, price: 134000, originalPrice: 179500, note: 'AZ Vi·ªát Nam', lastUpdated: '2025-02-07' },
      { code: 'KT002', name: 'T∆Ø DUY ƒê·∫¶U T∆Ø - TI·ªÄN ƒê·∫∫ RA TI·ªÄN', category: 'Kinh t·∫ø', stock: 32, price: 203000, originalPrice: 239000, note: '1980 Books', lastUpdated: '2025-01-31' },
      { code: 'KT003', name: 'TI·ªÄN ƒê·∫∫ RA TI·ªÄN - ƒê·∫¶U T∆Ø T√ÄI CH√çNH TH√îNG MINH', category: 'Kinh t·∫ø', stock: 63, price: 128000, originalPrice: 160000, note: 'NXB Lao ƒê·ªông', lastUpdated: '2025-02-04' },
      { code: 'GK001', name: 'TUY·ªÇN T·∫¨P B√ÄI VƒÇN NGH·ªä LU·∫¨N X√É H·ªòI CHON L·ªåC', category: 'Gi√°o khoa', stock: 142, price: 90000, originalPrice: 120000, note: 'NXB ƒê·∫°i H·ªçc', lastUpdated: '2025-02-12' },
      { code: 'GK002', name: 'LUY·ªÜN THI V√ÄO 10 NG·ªÆ VƒÇN - CHINH PH·ª§C B√ÄI NGH·ªä LU·∫¨N', category: 'Gi√°o khoa', stock: 118, price: 71500, originalPrice: 89000, note: 'H·ªìng ƒê·ª©c', lastUpdated: '2025-02-01' },
      { code: 'GK003', name: 'TAKENOTE NG·ªÆ PH√ÅP TR·ªåNG ƒêI·ªÇM TI·∫æNG ANH TRUNG H·ªåC C∆† S·ªû', category: 'Gi√°o khoa', stock: 158, price: 71200, originalPrice: 89000, note: 'ƒêinh T·ªã', lastUpdated: '2025-02-09' }
    ];

    let filteredStock = [...stockItems];

    const el = {
      table: document.getElementById('stockTable'),
      summary: document.getElementById('stockSummary'),
      search: document.getElementById('searchInput'),
      category: document.getElementById('categoryFilter'),
      dateFrom: document.getElementById('stockDateFrom'),
      dateTo: document.getElementById('stockDateTo'),
      filterBtn: document.getElementById('stockFilterBtn'),
      resetBtn: document.getElementById('stockResetBtn')
    };

    const formatCurrency = (value) => Number(value || 0).toLocaleString('vi-VN') + 'ƒë';

    const formatDate = (value) => {
      if (!value) return '‚Äî';
      const date = new Date(value);
      return Number.isNaN(date.getTime()) ? value : date.toLocaleDateString('vi-VN');
    };

    const getStockBadgeClass = (qty) => {
      if (qty >= 120) return 'stock-high';
      if (qty >= 60) return 'stock-medium';
      return 'stock-low';
    };

    const renderStockTable = () => {
      if (!el.table) return;
      if (!filteredStock.length) {
        el.table.innerHTML = `<tr><td colspan="7" class="text-center text-muted">Kh√¥ng c√≥ s·∫£n ph·∫©m ph√π h·ª£p.</td></tr>`;
      } else {
        el.table.innerHTML = filteredStock
          .map((item) => `
            <tr>
              <td><span class="sku-pill">${item.code}</span></td>
              <td>${item.name}</td>
              <td><span class="badge-cat">${item.category}</span></td>
              <td><span class="stock-badge ${getStockBadgeClass(item.stock)}">${item.stock}</span></td>
              <td>
                ${formatCurrency(item.price)}
                <span class="price-original">${formatCurrency(item.originalPrice)}</span>
              </td>
              <td>${formatDate(item.lastUpdated)}</td>
              <td>${item.note || ''}</td>
            </tr>
          `)
          .join('');
      }

      if (el.summary) {
        el.summary.textContent = `${filteredStock.length} s·∫£n ph·∫©m`;
      }
    };

    const normalizeText = (value) => (value || '').toString().toLowerCase();

    const parseDateBoundary = (value, isEnd = false) => {
      if (!value) return null;
      const date = new Date(value);
      if (Number.isNaN(date.getTime())) return null;
      if (isEnd) {
        date.setHours(23, 59, 59, 999);
      } else {
        date.setHours(0, 0, 0, 0);
      }
      return date.getTime();
    };

    const applyFilters = () => {
      const searchValue = normalizeText(el.search?.value || '');
      const categoryValue = el.category?.value || '';
      const fromTime = parseDateBoundary(el.dateFrom?.value);
      const toTime = parseDateBoundary(el.dateTo?.value, true);

      filteredStock = stockItems.filter((item) => {
        const combined = normalizeText(`${item.name} ${item.code}`);
        const matchesSearch = !searchValue || combined.includes(searchValue);
        const matchesCategory = !categoryValue || item.category === categoryValue;
        const updatedTime = new Date(item.lastUpdated).getTime();
        const matchesFrom = !fromTime || (!Number.isNaN(updatedTime) && updatedTime >= fromTime);
        const matchesTo = !toTime || (!Number.isNaN(updatedTime) && updatedTime <= toTime);
        return matchesSearch && matchesCategory && matchesFrom && matchesTo;
      });

      renderStockTable();
    };

    const resetFilters = () => {
      if (el.search) el.search.value = '';
      if (el.category) el.category.value = '';
      if (el.dateFrom) el.dateFrom.value = '';
      if (el.dateTo) el.dateTo.value = '';
      filteredStock = [...stockItems];
      renderStockTable();
    };

    el.search?.addEventListener('input', applyFilters);
    el.category?.addEventListener('change', applyFilters);
    el.dateFrom?.addEventListener('change', applyFilters);
    el.dateTo?.addEventListener('change', applyFilters);
    el.filterBtn?.addEventListener('click', applyFilters);
    el.resetBtn?.addEventListener('click', resetFilters);

    renderStockTable();
  });
</script>
</html>
