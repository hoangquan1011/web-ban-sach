<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin - Qu·∫£n l√Ω Gi√° | Th·ª©c Store</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/admin-shared.css">

  <style>
    body { background:#f3f8f3; font-family:"Open Sans",sans-serif; }
    .content-area{ background:#fff; padding:1.5rem; border-radius:1rem; box-shadow:0 3px 8px rgba(0,0,0,0.04); min-height:65vh; }
    .card { border:none; border-radius:1rem; box-shadow:0 8px 24px rgba(0,0,0,0.05); }
    .card-header { border-bottom:1px solid #eef4ef; background:#f8fffb; border-radius:1rem 1rem 0 0 !important; }
    .table thead { background:#f5f8f6; color:#2d6a4f; font-weight:600; }
    .price-input { max-width: 140px; }
    .feedback { position: fixed; right: 24px; bottom: 24px; z-index: 9; min-width: 260px; }
  </style>
</head>
<body>
  <div class="container-fluid py-4">
    <div class="admin-banner">
      <div class="text-center">
        <h1 class="h2 fw-bold">Th·ª©c Store Admin</h1>
        <div class="small">Qu·∫£n l√Ω gi√° b√°n ‚Äî giao di·ªán thao t√°c nhanh</div>
      </div>
    </div>

    <div class="row g-4">
      <!-- Sidebar -->
      <div class="col-lg-3 mb-4">
        <div class="sidebar">
          <h5>üìã Menu qu·∫£n l√Ω</h5>
          <a href="quanlysanpham.html" class="menu-item"><span class="emoji">üìò</span> Qu·∫£n l√Ω S·∫£n ph·∫©m</a>
          <a href="quanlydonhang.html" class="menu-item"><span class="emoji">üßæ</span> Qu·∫£n l√Ω ƒê∆°n h√†ng</a>
          <a href="user.html" class="menu-item"><span class="emoji">üë§</span> Qu·∫£n l√Ω Ng∆∞·ªùi d√πng</a>
          <a href="stock.html" class="menu-item"><span class="emoji">üì¶</span> Qu·∫£n l√Ω Kho</a>
          <a href="pricing.html" class="menu-item active"><span class="emoji">üí≤</span> Qu·∫£n l√Ω Gi√°</a>
          <a href="import.html" class="menu-item"><span class="emoji">üöö</span> Nh·∫≠p h√†ng</a>
        </div>
      </div>

      <div class="col-lg-9">
        <div class="content-area">
          <div class="d-flex flex-column flex-md-row justify-content-between gap-2 mb-4">
            <div>
              <h4 class="text-success mb-1">Thi·∫øt l·∫≠p gi√° b√°n</h4>
              <p class="text-muted mb-0">Giao di·ªán ch·ªâ minh ho·∫°. D·ªØ li·ªáu c·∫≠p nh·∫≠t c·ª•c b·ªô trong l·∫ßn m·ªü trang n√†y.</p>
            </div>
            <button id="btnDownload" class="btn btn-outline-success btn-sm"><i class="fa-solid fa-file-export me-2"></i>Xu·∫•t b·∫£ng (JSON)</button>
          </div>

          <div class="card mb-4">
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-5">
                  <label class="form-label">T√¨m ki·∫øm (t√™n ho·∫∑c m√£ s·∫£n ph·∫©m)</label>
                  <input id="searchInput" class="form-control" placeholder="V√≠ d·ª•: VH001 / ƒê·∫Øc Nh√¢n T√¢m">
                </div>
                <div class="col-md-4">
                  <label class="form-label">L·ªçc theo nh√≥m</label>
                  <select id="categoryFilter" class="form-select">
                    <option value="">-- T·∫•t c·∫£ lo·∫°i --</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label class="form-label">Kho·∫£ng gi√° b√°n</label>
                  <div class="d-flex gap-2">
                    <input id="minPrice" type="number" class="form-control" placeholder="T·ª´">
                    <input id="maxPrice" type="number" class="form-control" placeholder="ƒê·∫øn">
                  </div>
                </div>
              </div>
              <div class="text-end mt-3">
                <button id="btnReset" class="btn btn-outline-secondary btn-sm">ƒê·∫∑t l·∫°i b·ªô l·ªçc</button>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header d-flex flex-wrap gap-2 justify-content-between align-items-center">
              <h5 class="mb-0 text-success"><i class="fa-solid fa-tags me-2"></i>Danh s√°ch s·∫£n ph·∫©m</h5>
              <span id="tableSummary" class="text-muted">0 s·∫£n ph·∫©m</span>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover align-middle">
                  <thead>
                    <tr>
                      <th>M√£</th>
                      <th>T√™n s·∫£n ph·∫©m</th>
                      <th>Gi√° v·ªën</th>
                      <th>Gi√° b√°n hi·ªán t·∫°i</th>
                      <th>L·ª£i nhu·∫≠n ∆∞·ªõc t√≠nh</th>
                      <th style="width:140px;">H√†nh ƒë·ªông</th>
                    </tr>
                  </thead>
                  <tbody id="pricingTable">
                    <tr><td colspan="6" class="text-center text-muted">ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="feedback" class="feedback d-none">
    <div class="alert alert-success shadow mb-0" role="alert">
      <span id="feedbackText">ƒê√£ c·∫≠p nh·∫≠t gi√°.</span>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const demoProducts = [
        { code: 'VH001', name: 'ƒê·∫Øc Nh√¢n T√¢m', category: 'VƒÉn h·ªçc', cost: 52000, price: 86000 },
        { code: 'VH002', name: 'Nh√† Gi·∫£ Kim', category: 'VƒÉn h·ªçc', cost: 48000, price: 79000 },
        { code: 'KT001', name: 'T∆∞ Duy ƒê·∫ßu T∆∞', category: 'Kinh t·∫ø', cost: 89000, price: 139000 },
        { code: 'KT002', name: 'The Little Book', category: 'Kinh t·∫ø', cost: 99000, price: 155000 },
        { code: 'KS001', name: '7 Th√≥i Quen Hi·ªáu Qu·∫£', category: 'K·ªπ nƒÉng s·ªëng', cost: 74000, price: 118000 },
        { code: 'TN001', name: 'D·∫ø M√®n Phi√™u L∆∞u K√Ω', category: 'Thi·∫øu nhi', cost: 35000, price: 59000 }
      ];

      const state = [...demoProducts];
      const el = {
        search: document.getElementById('searchInput'),
        category: document.getElementById('categoryFilter'),
        minPrice: document.getElementById('minPrice'),
        maxPrice: document.getElementById('maxPrice'),
        table: document.getElementById('pricingTable'),
        summary: document.getElementById('tableSummary'),
        resetBtn: document.getElementById('btnReset'),
        downloadBtn: document.getElementById('btnDownload'),
        feedback: document.getElementById('feedback'),
        feedbackText: document.getElementById('feedbackText')
      };

      const formatCurrency = (value) =>
        Number(value || 0).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' }).replace('‚Ç´', 'ƒë');

      const calcProfitPercent = (cost, price) => {
        if (!cost) return 0;
        return Math.round(((price - cost) / cost) * 1000) / 10;
      };

      const showFeedback = (msg) => {
        if (!el.feedback) return;
        el.feedbackText.textContent = msg;
        el.feedback.classList.remove('d-none');
        setTimeout(() => el.feedback.classList.add('d-none'), 2200);
      };

      const populateCategories = () => {
        if (!el.category) return;
        const existing = el.category.value;
        const cats = [...new Set(state.map((p) => p.category))];
        el.category.innerHTML = '<option value="">-- T·∫•t c·∫£ lo·∫°i --</option>';
        cats.forEach((c) => {
          const option = document.createElement('option');
          option.value = c;
          option.textContent = c;
          el.category.appendChild(option);
        });
        if (existing && cats.includes(existing)) el.category.value = existing;
      };

      const getFilters = () => ({
        search: el.search?.value?.trim().toLowerCase() || '',
        category: el.category?.value || '',
        min: Number(el.minPrice?.value || '') || null,
        max: Number(el.maxPrice?.value || '') || null
      });

      const renderTable = () => {
        if (!el.table) return;
        populateCategories();
        const filters = getFilters();
        const rows = state.filter((p) => {
          const code = p.code.toLowerCase();
          const name = p.name.toLowerCase();
          const matchesSearch = !filters.search || code.includes(filters.search) || name.includes(filters.search);
          const matchesCategory = !filters.category || p.category === filters.category;
          const matchesMin = filters.min === null || p.price >= filters.min;
          const matchesMax = filters.max === null || p.price <= filters.max;
          return matchesSearch && matchesCategory && matchesMin && matchesMax;
        });

        el.summary.textContent = `${rows.length} s·∫£n ph·∫©m`;

        if (!rows.length) {
          el.table.innerHTML = '<tr><td colspan="6" class="text-center text-muted">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m ph√π h·ª£p.</td></tr>';
          return;
        }

        el.table.innerHTML = rows.map((p) => {
          const profit = calcProfitPercent(p.cost, p.price);
          return `
            <tr>
              <td><strong>${p.code}</strong><div class="text-muted small">${p.category}</div></td>
              <td>${p.name}</td>
              <td>${formatCurrency(p.cost)}</td>
              <td>
                <input type="number" class="form-control form-control-sm price-input" data-code="${p.code}" value="${p.price}" min="0">
              </td>
              <td>
                <div>${formatCurrency(p.price - p.cost)}</div>
                <small class="text-muted">${profit}%</small>
              </td>
              <td>
                <button class="btn btn-success btn-sm update-price" data-code="${p.code}">
                  <i class="fa-solid fa-floppy-disk me-1"></i>L∆∞u gi√°
                </button>
              </td>
            </tr>
          `;
        }).join('');
      };

      const handlePriceUpdate = (code) => {
        const input = document.querySelector(`.price-input[data-code="${code}"]`);
        if (!input) return;
        const value = Number(input.value);
        if (Number.isNaN(value) || value <= 0) {
          alert('Vui l√≤ng nh·∫≠p gi√° b√°n h·ª£p l·ªá.');
          return;
        }
        const product = state.find((p) => p.code === code);
        if (!product) return;
        product.price = value;
        showFeedback(`ƒê√£ c·∫≠p nh·∫≠t gi√° cho ${product.name}.`);
        renderTable();
      };

      el.search?.addEventListener('input', renderTable);
      el.category?.addEventListener('change', renderTable);
      el.minPrice?.addEventListener('input', renderTable);
      el.maxPrice?.addEventListener('input', renderTable);
      el.resetBtn?.addEventListener('click', () => {
        if (el.search) el.search.value = '';
        if (el.category) el.category.value = '';
        if (el.minPrice) el.minPrice.value = '';
        if (el.maxPrice) el.maxPrice.value = '';
        renderTable();
      });

      document.addEventListener('click', (e) => {
        if (e.target.closest('.update-price')) {
          const btn = e.target.closest('.update-price');
          handlePriceUpdate(btn.dataset.code);
        }
      });

      el.downloadBtn?.addEventListener('click', () => {
        const blob = new Blob([JSON.stringify(state, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'thuc-store-pricing-demo.json';
        a.click();
        URL.revokeObjectURL(url);
      });

      renderTable();
    });
  </script>
</body>
</html>
