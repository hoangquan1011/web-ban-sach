<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qu·∫£n l√Ω s·∫£n ph·∫©m (S√°ch)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f9; }
    h1 { text-align: center; margin-bottom: 20px; }
    .btn { padding: 8px 14px; border: none; border-radius: 4px; cursor: pointer; }
    .btn-add { background: #28a745; color: #fff; margin-bottom: 15px; }
    .btn-edit { background: #007bff; color: #fff; }
    .btn-del { background: #dc3545; color: #fff; }
    .btn-cancel { background: #6c757d; color: #fff; margin-left: 10px; }
    table { width: 100%; border-collapse: collapse; background: #fff; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background: #5B8C51; color: white; }
    tr:nth-child(even) { background: #f2f2f2; }
    img { width: 60px; height: 60px; object-fit: cover; border-radius: 4px; }

    /* Form th√™m/s·ª≠a */
    #form-container {
      max-width: 500px; margin: auto; background: #fff; padding: 20px;
      border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: none;
    }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, textarea { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; }
    img.preview { margin-top: 10px; max-height: 120px; display: block; }
  </style>
</head>
<body>
  <h1 id="title">Danh s√°ch s·∫£n ph·∫©m (S√°ch)</h1>

  <!-- üîπ DANH S√ÅCH S·∫¢N PH·∫®M -->
  <div id="list-container">
    <button class="btn btn-add" onclick="openForm('add')">+ Th√™m s·∫£n ph·∫©m</button>

    <table>
      <thead>
        <tr>
          <th>STT</th>
          <th>·∫¢nh</th>
          <th>M√£ SP</th>
          <th>T√™n s√°ch</th>
          <th>Gi√°</th>
          <th>M√¥ t·∫£</th>
          <th>H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody id="product-body"></tbody>
    </table>
  </div>

  <!-- üîπ FORM TH√äM / S·ª¨A -->
  <div id="form-container">
    <h2 id="form-title">Th√™m s·∫£n ph·∫©m</h2>
    <form id="product-form">
      <label>M√£ s·∫£n ph·∫©m:</label>
      <input type="text" id="product-id" required>

      <label>T√™n s√°ch:</label>
      <input type="text" id="product-name" required>

      <label>H√¨nh s·∫£n ph·∫©m:</label>
      <input type="file" id="product-image" accept="image/*">
      <img id="preview" class="preview" style="display:none;">

      <label>M√¥ t·∫£:</label>
      <textarea id="product-desc"></textarea>

      <label>Gi√° (VNƒê):</label>
      <input type="number" id="product-price" required min="0" placeholder="Nh·∫≠p gi√° ti·ªÅn...">

      <button type="submit" class="btn btn-add">üíæ L∆∞u s·∫£n ph·∫©m</button>
      <button type="button" class="btn btn-cancel" onclick="closeForm()">H·ªßy</button>
    </form>
  </div>

  <script>
    let products = JSON.parse(localStorage.getItem("products")) || [];
    let editMode = null;
    let editId = null;

    const listContainer = document.getElementById("list-container");
    const formContainer = document.getElementById("form-container");
    const form = document.getElementById("product-form");
    const preview = document.getElementById("preview");
    const title = document.getElementById("title");
    const formTitle = document.getElementById("form-title");

    const inputId = document.getElementById("product-id");
    const inputName = document.getElementById("product-name");
    const inputImage = document.getElementById("product-image");
    const inputDesc = document.getElementById("product-desc");
    const inputPrice = document.getElementById("product-price");

    // Hi·ªÉn th·ªã danh s√°ch s·∫£n ph·∫©m
    function loadProducts() {
      const body = document.getElementById("product-body");
      body.innerHTML = "";

      if (products.length === 0) {
        body.innerHTML = `<tr><td colspan="7">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o.</td></tr>`;
        return;
      }

      products.forEach((p, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${index + 1}</td>
          <td><img src="${p.image || 'https://via.placeholder.com/60'}" alt="${p.name}"></td>
          <td>${p.id}</td>
          <td>${p.name}</td>
          <td>${p.price.toLocaleString()} ƒë</td>
          <td>${p.desc}</td>
          <td>
            <button class="btn btn-edit" onclick="openForm('edit','${p.id}')">S·ª≠a</button>
            <button class="btn btn-del" onclick="deleteProduct('${p.id}')">X√≥a</button>
          </td>
        `;
        body.appendChild(row);
      });
    }

    // M·ªü form th√™m ho·∫∑c s·ª≠a
    function openForm(mode, id = null) {
      editMode = mode;
      editId = id;
      listContainer.style.display = "none";
      formContainer.style.display = "block";
      title.textContent = mode === "add" ? "Th√™m s·∫£n ph·∫©m m·ªõi" : "S·ª≠a s·∫£n ph·∫©m";
      formTitle.textContent = title.textContent;

      // Reset form
      form.reset();
      preview.style.display = "none";

      if (mode === "edit" && id) {
        const p = products.find(x => x.id === id);
        if (p) {
          inputId.value = p.id;
          inputId.disabled = true;
          inputName.value = p.name;
          inputDesc.value = p.desc;
          inputPrice.value = p.price;
          if (p.image) {
            preview.src = p.image;
            preview.style.display = "block";
          }
        }
      } else {
        inputId.disabled = false;
      }
    }

    // ƒê√≥ng form
    function closeForm() {
      formContainer.style.display = "none";
      listContainer.style.display = "block";
      title.textContent = "Danh s√°ch s·∫£n ph·∫©m (S√°ch)";
    }

    // Xem tr∆∞·ªõc h√¨nh ·∫£nh
    inputImage.addEventListener("change", function() {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = e => {
          preview.src = e.target.result;
          preview.style.display = "block";
        };
        reader.readAsDataURL(file);
      }
    });

    // L∆∞u s·∫£n ph·∫©m
    form.addEventListener("submit", function(e) {
      e.preventDefault();

      const product = {
        id: inputId.value.trim(),
        name: inputName.value.trim(),
        desc: inputDesc.value.trim(),
        price: parseFloat(inputPrice.value),
        image: preview.src || ""
      };

      if (editMode === "add") {
        if (products.some(p => p.id === product.id)) {
          alert("‚ùå M√£ s·∫£n ph·∫©m ƒë√£ t·ªìn t·∫°i!");
          return;
        }
        products.push(product);
      } else if (editMode === "edit" && editId) {
        const index = products.findIndex(p => p.id === editId);
        products[index] = product;
      }

      localStorage.setItem("products", JSON.stringify(products));
      alert("‚úÖ L∆∞u s·∫£n ph·∫©m th√†nh c√¥ng!");
      closeForm();
      loadProducts();
    });

    // X√≥a s·∫£n ph·∫©m
    function deleteProduct(id) {
      if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m n√†y kh√¥ng?")) {
        products = products.filter(p => p.id !== id);
        localStorage.setItem("products", JSON.stringify(products));
        loadProducts();
      }
    }

    // Kh·ªüi t·∫°o
    loadProducts();
  </script>
</body>
</html>
