
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qu·∫£n l√Ω s·∫£n ph·∫©m</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #e9efd6;
      color: #333;
    }

    /* Header */
    header {
      background:  #404A3D;
      color: white;
      padding: 15px 20px;
      text-align: center;
      font-size: 50px;
      font-weight: bold;
      font-family: "Times New Roman", Times, serif;
}


    .container {
      max-width: 1000px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      font-family: "Times New Roman", Times, serif;
    }

    h2, h3 {
      margin-top: 0;
      color: #404A3D;
    }

    form div {
      margin-bottom: 10px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    input, textarea, button {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }

    button {
      background: #404A3D;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
    }

    button:hover {
      background: #404A3D;
    }

    .delete-btn {
      background: #d32f2f;
      margin-top: 5px;
    }
    .delete-btn:hover {
      background: #a62828;
    }

    /* Danh s√°ch s·∫£n ph·∫©m */
    .product-box {
      display: flex;
      align-items: center;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
      background: #fafafa;
    }

    .product-box img {
      max-width: 80px;
      margin-right: 15px;
      border-radius: 6px;
    }

    .product-info {
      flex: 1;
    }

    #searchInput {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin: 10px 0;
    }

/* L∆∞·ªõi s·∫£n ph·∫©m */
/* #productList {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 20px;
  justify-content: center;   /* üöÄ cƒÉn gi·ªØa c√°c card */
 
#productList .card {
  width: 180px;      /* c·ªë ƒë·ªãnh ƒë·ªÉ cƒÉn chu·∫©n */
}


#productList {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 12px;
  justify-content: center;   /* cƒÉn gi·ªØa c√°c c·ªôt */
  justify-items: center;     /* cƒÉn gi·ªØa card trong c·ªôt */
  padding: 10px;
  box-sizing: border-box;
}
/* Card s·∫£n ph·∫©m */
.product-box {
  border: 1px solid #ddd;
  border-radius: 8px;
  background: #fff;
  padding: 10px;
  text-align: center;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  width: 175px;  /* üöÄ th√™m: ƒë·∫£m b·∫£o m·ªói box ƒë·ªß r·ªông */
}

/* ·∫¢nh s·∫£n ph·∫©m */
.product-box img {
  width: 100%;
  height: 180px;
  object-fit: cover;
  border-radius: 6px;
  margin-bottom: 8px;
}

/* Th√¥ng tin */
.product-info {
  flex: 1;
  font-size: 14px;
  margin-bottom: 10px;
}

/* H√†nh ƒë·ªông */
.product-actions {
  display: grid;
  grid-template-columns: repeat(3, 1fr); /* 3 n√∫t ƒë·ªÅu nhau */
  gap: 4px;
  margin-top: 8px;
}

.product-actions button {
  width: 100%;        /* √©p n√∫t chi·∫øm tr·ªçn √¥ l∆∞·ªõi */
  padding: 5px 0;     /* chi·ªÅu cao g·ªçn g√†ng */
  font-size: 13px;
  height: 30px;  
  border-radius: 6px;
  cursor: pointer;
  box-sizing: border-box; /* tr√°nh b·ªã tr√†n do padding */
  text-align: center;
  align-items: center; 
  min-width: 50px;
  line-height: 30px;  /* cƒÉn gi·ªØa ch·ªØ theo chi·ªÅu d·ªçc */
  padding: 0;  

}
/* Ri√™ng n√∫t X√≥a */
.product-actions .delete-btn {
  height: 29.5px;                 /* gi·ªØ ƒë√∫ng chi·ªÅu cao */
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  top: -3.6px;
  font-size: 13px;
}



/* N√∫t m√†u */
.delete-btn { background: #d32f2f; color: white; }
.toggle-btn { background: #404A3D; color: white; }
.edit-btn   { background: #4c6b5f; color: white; }

.delete-btn:hover { background: #a62828; }
.toggle-btn:hover { background: #5c8468; }
.edit-btn:hover   { background: #478a72; }

    
/*.product-actions .delete-btn { 
        background: #e10a0a; 
        color: #fff; } 

.product-actions .delete-btn:hover { 
            background: #a62828; } /* N√∫t ·∫©n/hi·ªán */ 

/*.product-actions .toggle-btn { 
                background: #404A3D; 
                color: #fff; } 

.product-actions .toggle-btn:hover { 
                    background: #2e352a; } 
    /* N√∫t s·ª≠a */
/*.product-actions .edit-btn {
  background: #1976d2;
  color: #fff;
}
.product-actions .edit-btn:hover {
  background: #0d47a1;
}*/




.modal {
  display: none; 
  position: fixed; 
  z-index: 1000; 
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.5);
}
.modal-content {
  background: #fff;
  margin: 5% auto;
  padding: 20px;
  border-radius: 10px;
  width: 500px;
  max-width: 95%;
    max-height: 80vh;          
  overflow-y: auto;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}
/* ‚úÖ T√πy ch·ªçn: thanh cu·ªôn g·ªçn h∆°n */
.modal-content::-webkit-scrollbar {
  width: 8px;
}
.modal-content::-webkit-scrollbar-thumb {
  background: #ccc;
  border-radius: 4px;
}
.modal-content::-webkit-scrollbar-thumb:hover {
  background: #999;
}
.close {
  float: right;
  font-size: 24px;
  font-weight: bold;
  cursor: pointer;
}
.btn-save {
  background: #404A3D; color: #fff; border: none;
  padding: 8px; border-radius: 6px; cursor: pointer; flex:1;
}
.btn-cancel {
  background: #777; color: #fff; border: none;
  padding: 8px; border-radius: 6px; cursor: pointer; flex:1;
}



  </style>



</head>
<body>
  <header>Qu·∫£n l√Ω s·∫£n ph·∫©m</header>
<div class="container">
  <h2>Th√™m s·∫£n ph·∫©m</h2>


    <!-- ‚úÖ Form th√™m s·∫£n ph·∫©m -->

<form id="addProductForm">
  <div>
    <label>Th·ªÉ lo·∫°i:</label><br>
    <input type="text" id="loai" required>
  </div>

  <div>
    <label>M√£ s·∫£n ph·∫©m:</label><br>
    <input type="text" id="ma" required>
  </div>

  <div>
    <label>T√™n s√°ch:</label><br>
    <input type="text" id="ten" required>
  </div>

    <div>
    <label>T√°c gi·∫£:</label><br>
     <input type="text" id="tacgia" required>
  </div>

    <div>
    <label>Nh√† xu·∫•t b·∫£n:</label><br>
    <input type="text" id="nhaxuatban" required>
  </div>

      <div>
    <label>NƒÉm xu·∫•t b·∫£n:</label><br>
    <input type="text" id="namxuatban" required>
  </div>

  <div>
    <label>B√¨a s√°ch (ch·ªçn file):</label><br>
    <input type="file" id="hinh" accept="image/*" required>
  </div>

  <div>
    <label>M√¥ t·∫£:</label><br>
    <textarea id="mota" rows="3"></textarea>
  </div>

  <div>
    <label>Gi√° b√°n:</label><br>
    <input type="number" id="gia" required>
  </div>

  <div>
    <label>Gi√° g·ªëc:</label><br>
    <input type="number" id="giagoc" required>
  </div>

  <button type="submit">+ Th√™m s·∫£n ph·∫©m</button>
</form>

    <hr>
    <!-- ‚úÖ Danh s√°ch s·∫£n ph·∫©m ƒë·ªÉ qu·∫£n l√Ω -->
    <h3>Danh s√°ch s·∫£n ph·∫©m</h3>
    <input type="text" id="searchInput" placeholder="üîç T√¨m s·∫£n ph·∫©m theo t√™n ho·∫∑c m√£...">
    <select id="categoryFilter">
  <option value="">-- T·∫•t c·∫£ lo·∫°i --</option>
  <option value="Ti·ªÉu thuy·∫øt">Ti·ªÉu thuy·∫øt</option>
  <option value="Ng√¥n t√¨nh">Ng√¥n t√¨nh</option>
  <option value="Truy·ªán tranh">Truy·ªán tranh</option>
  <option value="Truy·ªán ngo√†i n∆∞·ªõc">Truy·ªán ngo√†i n∆∞·ªõc</option>
  <option value="Truy·ªán trong n∆∞·ªõc">Truy·ªán trong n∆∞·ªõc</option>
</select>

<select id="priceFilter">
  <option value="">-- T·∫•t c·∫£ gi√° --</option>
  <option value="duoi100">D∆∞·ªõi 100.000ƒë</option>
  <option value="100-200">100k - 200.000ƒë</option>
  <option value="tren200">Tr√™n 200.000ƒë</option>
</select>

    <div id="productList"></div>
  </div>

  <script>

    // ‚úÖ Th√™m s·∫£n ph·∫©m
    document.getElementById("addProductForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const fileInput = document.getElementById("hinh").files[0];
      if (!fileInput) {
        alert("Vui l√≤ng ch·ªçn ·∫£nh!");
        return;
      }

      const reader = new FileReader();
      reader.onload = function(event) {
        let product = {
          loai: document.getElementById("loai").value.split(",").map(x => x.trim()),
          ma: document.getElementById("ma").value,
          ten: document.getElementById("ten").value,
          hinh: event.target.result,
          mota: document.getElementById("mota").value,
          gia: document.getElementById("gia").value,
          giagoc: document.getElementById("giagoc").value,
          nhaxuatban: document.getElementById("nhaxuatban").value,
          namxuatban: document.getElementById("namxuatban").value, 
        an: false
        };

        let products = JSON.parse(localStorage.getItem("products")) || [];
        products.push(product);
        localStorage.setItem("products", JSON.stringify(products));

        alert("‚úÖ ƒê√£ th√™m s·∫£n ph·∫©m th√†nh c√¥ng!");
        document.getElementById("addProductForm").reset();
        renderProducts();
      };

      reader.readAsDataURL(fileInput);
    });
    
// ‚úÖ H√†m xo√° s·∫£n ph·∫©m 
function deleteProduct(index) 
{ let products = JSON.parse(localStorage.getItem("products")) || []; 
if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën xo√° s·∫£n ph·∫©m n√†y?")) 
{ products.splice(index, 1); localStorage.setItem("products", JSON.stringify(products));
renderProducts(document.getElementById("searchInput").value); } }

    //h√†m ·∫©n hi·ªán spham
    function toggleHide(index) {
    let products = JSON.parse(localStorage.getItem("products")) || [];
    products[index].an = !products[index].an; // ‚úÖ ƒê·ªïi true/false
    localStorage.setItem("products", JSON.stringify(products));
    renderProducts(document.getElementById("searchInput").value);
    }


function removeAccents(str) {
  return str
    .normalize("NFD")              // t√°ch d·∫•u
    .replace(/[\u0300-\u036f]/g, "") // xo√° d·∫•u
    .replace(/ƒë/g, "d")
    .replace(/ƒê/g, "D");
}

    // ‚úÖ Render danh s√°ch s·∫£n ph·∫©m trong admin (c√≥ filter t√¨m ki·∫øm)
   function renderProducts(filter = "") {
  let products = JSON.parse(localStorage.getItem("products")) || [];
  const productList = document.getElementById("productList");
  productList.innerHTML = "";

   let filterText = removeAccents(filter.toLowerCase().trim()); // üöÄ lo·∫°i b·ªè space th·ª´a

  // L·∫•y gi√° tr·ªã filter lo·∫°i & gi√°
  const category = document.getElementById("categoryFilter")?.value || "";
  const price = document.getElementById("priceFilter")?.value || "";

  products.forEach((p, index) => {
    let ten = removeAccents(p.ten.toLowerCase());
    let ma = removeAccents(p.ma.toLowerCase());
   
    // --- 1. L·ªçc theo t√™n / m√£ ---
    if (!(ten.includes(filterText) || ma.includes(filterText))) {
      return;
    }

    // --- 2. L·ªçc theo lo·∫°i ---
    let loaiArr = Array.isArray(p.loai) ? p.loai : [p.loai]; // √©p th√†nh m·∫£ng
    if (
      category &&
      !loaiArr.some(
        (l) => removeAccents(l.toLowerCase()) === removeAccents(category.toLowerCase())
      )
    ) {
      return;
    }


    // --- 3. L·ªçc theo gi√° ---
    let giaNum = parseInt(p.gia, 10);
    if (price === "duoi100" && giaNum >= 100.000) return;
    if (price === "100-200" && (giaNum < 100.000 || giaNum > 200.000)) return;
    if (price === "tren200" && giaNum <= 200.000) return;

     // --- 4. T·∫°o ph·∫ßn t·ª≠ s·∫£n ph·∫©m ---
    const div = document.createElement("div");
    div.classList.add("product-box");

    div.innerHTML = `
      <img src="${p.hinh}" alt="${p.ten}" class="product-img" style="cursor:pointer;">
      <div class="product-info" style="cursor:pointer;">
        <strong>${p.ten}</strong><br>
        <small>Lo·∫°i: ${p.loai} | M√£: ${p.ma}</small><br>
        <span class="text-danger fw-bold">${p.gia}ƒë</span>
        <span class="text-muted" style="text-decoration:line-through;">${p.giagoc}ƒë</span><br>
        <em style="color:${p.an ? 'red' : 'green'}">${p.an ? 'ƒêang ·∫©n' : 'ƒêang hi·ªÉn th·ªã'}</em>
      </div>
      <div class="product-actions">
        <button class="delete-btn" onclick="deleteProduct(${index})">Xo√°</button>
        <button class="toggle-btn" onclick="toggleHide(${index})">${p.an ? 'Hi·ªán' : '·∫®n'}</button>
        <button class="edit-btn" onclick="openEditModal(${index})">S·ª≠a</button>
      </div>
    `;



    // ‚úÖ Khi click v√†o ·∫£nh ho·∫∑c ph·∫ßn th√¥ng tin ‚Üí l∆∞u s·∫£n ph·∫©m & m·ªü trang chi ti·∫øt
    div.querySelector(".product-img").addEventListener("click", () => {
      localStorage.setItem("selectedProduct", JSON.stringify(p));
      window.location.href = "chitiet.html";
    });

    div.querySelector(".product-info").addEventListener("click", () => {
      localStorage.setItem("selectedProduct", JSON.stringify(p));
      window.location.href = "chitiet.html";
    });

    productList.appendChild(div);



  });
}







    //h√†m s·ª≠a spham
//function editProduct(index) {
  //localStorage.setItem("editIndex", index);
 // window.location.href = "editProduct.html";
//}


    // ‚úÖ G·∫Øn s·ª± ki·ªán t√¨m ki·∫øm
    document.getElementById("searchInput").addEventListener("input", function() {
      renderProducts(this.value);
    });

    // ‚úÖ Khi load admin.html th√¨ render s·∫µn
    renderProducts();
    // G·∫Øn s·ª± ki·ªán t√¨m ki·∫øm
document.getElementById("searchInput").addEventListener("input", function() {
  renderProducts(this.value);
});

// G·∫Øn s·ª± ki·ªán l·ªçc lo·∫°i
document.getElementById("categoryFilter").addEventListener("change", () => {
  renderProducts(document.getElementById("searchInput").value);
});

// G·∫Øn s·ª± ki·ªán l·ªçc gi√°
document.getElementById("priceFilter").addEventListener("change", () => {
  renderProducts(document.getElementById("searchInput").value);
});

// Khi load admin.html th√¨ render s·∫µn
renderProducts();



let editIndex = null; // khai b√°o bi·∫øn to√†n c·ª•c

// ‚úÖ M·ªü popup s·ª≠a
function openEditModal(index) {
  const products = JSON.parse(localStorage.getItem("products")) || [];
  const product = products[index];
  if (!product) return;

  editIndex = index;

  // G√°n d·ªØ li·ªáu c≈© v√†o form
  document.getElementById("editLoai").value = Array.isArray(product.loai) ? product.loai.join(", ") : product.loai || "";
  document.getElementById("editMa").value = product.ma || "";
  document.getElementById("editTen").value = product.ten || "";
  document.getElementById("editTacGia").value = product.tacgia || "";
  document.getElementById("editNXB").value = product.nhaxuatban || "";
  document.getElementById("editNam").value = product.namxuatban || "";
  document.getElementById("editMota").value = product.mota || "";
  document.getElementById("editGia").value = product.gia || "";
  document.getElementById("editGiagoc").value = product.giagoc || "";
  document.getElementById("editPreview").src = product.hinh || "";
  document.getElementById("editPreview").style.display = product.hinh ? "block" : "none";

  document.getElementById("editModal").style.display = "block";
}

// ‚úÖ ƒê√≥ng popup
function closeEditModal() {
  document.getElementById("editModal").style.display = "none";
  editIndex = null;
}

// Sau khi DOM load th√¨ m·ªõi g·∫Øn event
document.addEventListener("DOMContentLoaded", function () {
  document.getElementById("closeModal").addEventListener("click", closeEditModal);
  document.getElementById("cancelEdit").addEventListener("click", closeEditModal);

  // ƒë√≥ng khi click ngo√†i modal-content
  window.addEventListener("click", function(e) {
    const modal = document.getElementById("editModal");
    if (e.target === modal) {
      closeEditModal();
    }
  });

  // ‚úÖ Preview ·∫£nh m·ªõi
  document.getElementById("editHinh").addEventListener("change", function() {
    const file = this.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = e => {
        document.getElementById("editPreview").src = e.target.result;
        document.getElementById("editPreview").style.display = "block";
      };
      reader.readAsDataURL(file);
    }
  });

  // ‚úÖ Submit form s·ª≠a
  document.getElementById("editForm").addEventListener("submit", function(e) {
    e.preventDefault();
    let products = JSON.parse(localStorage.getItem("products")) || [];
    if (editIndex === null || !products[editIndex]) return;

    const loai = document.getElementById("editLoai").value.split(",").map(l => l.trim()).filter(Boolean);
    const ma = document.getElementById("editMa").value.trim();
    const ten = document.getElementById("editTen").value.trim();
      const tacgia = document.getElementById("editTacGia").value.trim();
  const nhaxuatban = document.getElementById("editNXB").value.trim();
  const namxuatban = document.getElementById("editNam").value.trim();
    const mota = document.getElementById("editMota").value.trim();
    const gia = document.getElementById("editGia").value.trim();
    const giagoc = document.getElementById("editGiagoc").value.trim();
    const file = document.getElementById("editHinh").files[0];

    if (!ma || !ten || !gia || !giagoc|| !tacgia|| !namxuatban|| !nhaxuatban) {
      alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
      return;
    }

    const saveProduct = (img) => {
      products[editIndex] = {
        ...products[editIndex],
        loai, ma, ten, mota,
        gia, giagoc,tacgia, nhaxuatban, namxuatban,
        hinh: img || products[editIndex].hinh
      };
      localStorage.setItem("products", JSON.stringify(products));
       // ‚úÖ N·∫øu ƒëang xem trong chitiet.html ‚Üí c·∫≠p nh·∫≠t lu√¥n
    const selected = JSON.parse(localStorage.getItem("selectedProduct"));
    if (selected && selected.ma === ma) {
      localStorage.setItem("selectedProduct", JSON.stringify(products[editIndex]));
    }
      alert("‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng!");
      closeEditModal();
      if (typeof renderProducts === "function") {
        renderProducts();
      } else {
        location.reload();
      }
    };

    if (file) {
      const reader = new FileReader();
      reader.onload = e => saveProduct(e.target.result);
      reader.readAsDataURL(file);
    } else {
      saveProduct();
    }
  });
});

// ƒê√≥ng popup khi b·∫•m H·ªßy ho·∫∑c n√∫t X
//document.getElementById("cancelEdit").addEventListener("click", closeEditModal);
//document.getElementById("closeModal").addEventListener("click", closeEditModal);

  </script>




  <!-- Modal s·ª≠a s·∫£n ph·∫©m -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeModal">&times;</span>
    <h2>S·ª≠a s·∫£n ph·∫©m</h2>
    <form id="editForm">
      <div>
        <label>Th·ªÉ lo·∫°i:</label>
        <input type="text" id="editLoai">
      </div>
      <div>
        <label>M√£ s·∫£n ph·∫©m:</label>
        <input type="text" id="editMa" required>
      </div>
      <div>
        <label>T√™n s√°ch:</label>
        <input type="text" id="editTen" required>
      </div>
      <div>
  <label>T√°c gi·∫£:</label><br>
  <input type="text" id="editTacGia">
</div>

<div>
  <label>Nh√† xu·∫•t b·∫£n:</label><br>
  <input type="text" id="editNXB">
</div>

<div>
  <label>NƒÉm xu·∫•t b·∫£n:</label><br>
  <input type="number" id="editNam">
</div>

      <div>
        <label>B√¨a s√°ch:</label>
        <input type="file" id="editHinh" accept="image/*">
        <img id="editPreview" style="max-width:120px; margin-top:5px; display:block;">
      </div>
      <div>
        <label>M√¥ t·∫£:</label>
        <textarea id="editMota" rows="3"></textarea>
      </div>
      <div style="display:flex; gap:10px;">
        <div style="flex:1;">
          <label>Gi√° b√°n:</label>
          <input type="number" id="editGia" required>
        </div>
        <div style="flex:1;">
          <label>Gi√° g·ªëc:</label>
          <input type="number" id="editGiagoc" required>
        </div>
      </div>
      <div style="margin-top:15px; display:flex; gap:10px;">
        <button type="submit" class="btn-save">üíæ L∆∞u</button>
        <button type="button" id="cancelEdit" class="btn-cancel">H·ªßy</button>
      </div>
    </form>
  </div>
</div>
</body>
</html>
