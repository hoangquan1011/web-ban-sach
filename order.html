<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Äáº·t hÃ ng - Thá»©c Store</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      background: #f8f9fa;
      font-family: 'Segoe UI', sans-serif;
      padding: 40px 0;
    }
    .order-container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      padding: 30px;
    }
    .order-header {
      border-bottom: 3px solid #198754;
      margin-bottom: 20px;
      padding-bottom: 10px;
    }
    .order-header h2 {
      color: #198754;
      font-weight: 600;
    }
    .table img {
      width: 60px;
      height: 80px;
      object-fit: cover;
      border-radius: 6px;
    }
    .btn-success {
      background-color: #198754;
      border: none;
    }
    .btn-success:hover {
      background-color: #146c43;
    }
  </style>
</head>
<body>

<div class="order-container">
  <div class="order-header d-flex justify-content-between align-items-center">
    <h2><i class="fas fa-shopping-cart text-success"></i> XÃ¡c nháº­n Ä‘Æ¡n hÃ ng</h2>
    <a href="cart.html" class="btn btn-outline-success btn-sm">â† Quay láº¡i giá» hÃ ng</a>
  </div>

  <!-- ThÃ´ng tin sáº£n pháº©m -->
  <h5 class="mb-3">ğŸ›’ Sáº£n pháº©m báº¡n Ä‘Ã£ chá»n</h5>
  <div class="table-responsive">
    <table class="table table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>áº¢nh</th>
          <th>TÃªn sáº£n pháº©m</th>
          <th>Sá»‘ lÆ°á»£ng</th>
          <th>ÄÆ¡n giÃ¡</th>
          <th>ThÃ nh tiá»n</th>
        </tr>
      </thead>
      <tbody id="orderBody"></tbody>
    </table>
  </div>

  <div class="text-end fw-bold mb-4">
    Tá»•ng cá»™ng: <span id="orderTotal" class="text-danger">0Ä‘</span>
  </div>

  <!-- Äá»‹a chá»‰ giao hÃ ng -->
  <h5 class="mb-3">ğŸ“ ThÃ´ng tin giao hÃ ng</h5>
  <div id="addressSection">
    <div class="form-check mb-3">
      <input class="form-check-input" type="radio" name="addressOption" id="defaultAddress" checked>
      <label class="form-check-label" for="defaultAddress">
        DÃ¹ng Ä‘á»‹a chá»‰ máº·c Ä‘á»‹nh tá»« tÃ i khoáº£n
      </label>
    </div>

    <div class="form-check mb-3">
      <input class="form-check-input" type="radio" name="addressOption" id="newAddress">
      <label class="form-check-label" for="newAddress">
        Nháº­p Ä‘á»‹a chá»‰ giao hÃ ng má»›i
      </label>
    </div>

    <div id="newAddressForm" style="display:none;">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Há» tÃªn ngÆ°á»i nháº­n</label>
          <input type="text" class="form-control" id="recipientName" placeholder="Nguyá»…n VÄƒn A">
        </div>
        <div class="col-md-6">
          <label class="form-label">Sá»‘ Ä‘iá»‡n thoáº¡i</label>
          <input type="text" class="form-control" id="recipientPhone" placeholder="0123 456 789">
        </div>
        <div class="col-12">
          <label class="form-label">Äá»‹a chá»‰ cá»¥ thá»ƒ</label>
          <input type="text" class="form-control" id="recipientAddress" placeholder="273 An DÆ°Æ¡ng VÆ°Æ¡ng, TP.HCM">
        </div>
      </div>
    </div>
  </div>

  <!-- PhÆ°Æ¡ng thá»©c thanh toÃ¡n -->
  <h5 class="mt-4 mb-3">ğŸ’° HÃ¬nh thá»©c thanh toÃ¡n</h5>
  <select class="form-select mb-4" id="paymentMethod">
    <option value="cod">Thanh toÃ¡n tiá»n máº·t khi nháº­n hÃ ng (Máº·c Ä‘á»‹nh)</option>
    <option value="bank">Chuyá»ƒn khoáº£n ngÃ¢n hÃ ng</option>
    <option value="online">Thanh toÃ¡n trá»±c tuyáº¿n</option>
  </select>

  <!-- NÃºt xÃ¡c nháº­n -->
  <div class="text-end">
    <button class="btn btn-success px-4" id="confirmOrderBtn">
      <i class="fas fa-check"></i> XÃ¡c nháº­n Ä‘áº·t hÃ ng
    </button>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const currentUser = JSON.parse(localStorage.getItem("currentUser"));
  const cart = JSON.parse(localStorage.getItem("cart") || "[]");
  const orderBody = document.getElementById("orderBody");
  const orderTotal = document.getElementById("orderTotal");

  // ğŸ”’ Kiá»ƒm tra Ä‘Äƒng nháº­p
  if (!currentUser) {
    alert("Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ Ä‘áº·t hÃ ng!");
    window.location.href = "user/login.html";
    return;
  }

  // ğŸ›’ Hiá»ƒn thá»‹ giá» hÃ ng
  if (cart.length === 0) {
    orderBody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">Giá» hÃ ng trá»‘ng</td></tr>';
    document.getElementById("confirmOrderBtn").disabled = true;
    return;
  }

  let total = 0;
  cart.forEach(item => {
    const subTotal = item.qty * item.price;
    total += subTotal;
    orderBody.innerHTML += `
      <tr>
        <td><img src="${item.img}" alt="${item.name}"></td>
        <td>${item.name}</td>
        <td>${item.qty}</td>
        <td>${item.price.toLocaleString('vi-VN')}Ä‘</td>
        <td>${subTotal.toLocaleString('vi-VN')}Ä‘</td>
      </tr>`;
  });
  orderTotal.textContent = total.toLocaleString("vi-VN") + "Ä‘";

  // ğŸ“ Toggle Ä‘á»‹a chá»‰ má»›i
  document.getElementById("newAddress").addEventListener("change", e => {
    document.getElementById("newAddressForm").style.display = e.target.checked ? "block" : "none";
  });
  document.getElementById("defaultAddress").addEventListener("change", e => {
    if (e.target.checked) document.getElementById("newAddressForm").style.display = "none";
  });

  // ğŸŸ¢ XÃ¡c nháº­n Ä‘Æ¡n hÃ ng
  document.getElementById("confirmOrderBtn").addEventListener("click", () => {
    const method = document.getElementById("paymentMethod").value;
    const addressOption = document.querySelector("input[name='addressOption']:checked").id;
    let shippingInfo;

    if (addressOption === "defaultAddress") {
      shippingInfo = currentUser.address || "ChÆ°a cÃ³ Ä‘á»‹a chá»‰ trong tÃ i khoáº£n";
    } else {
      const name = document.getElementById("recipientName").value.trim();
      const phone = document.getElementById("recipientPhone").value.trim();
      const addr = document.getElementById("recipientAddress").value.trim();
      if (!name || !phone || !addr) return alert("Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin giao hÃ ng!");
      shippingInfo = `${name}, ${phone}, ${addr}`;
    }

    const order = {
      user: currentUser.username,
      cart,
      total,
      payment: method,
      address: shippingInfo,
      time: new Date().toLocaleString("vi-VN")
    };

    // ğŸ—‚ï¸ LÆ°u vÃ o danh sÃ¡ch Ä‘Æ¡n hÃ ng
    const orders = JSON.parse(localStorage.getItem("orders") || "[]");
    orders.push(order);
    localStorage.setItem("orders", JSON.stringify(orders));

    // ğŸ§¹ XÃ³a giá» hÃ ng
    localStorage.removeItem("cart");

    alert("Äáº·t hÃ ng thÃ nh cÃ´ng! Cáº£m Æ¡n báº¡n Ä‘Ã£ mua sáº¯m táº¡i Thá»©c Store â¤ï¸");
    window.location.href = "trang-chu-user.html";
  });
});
</script>

</body>
</html>
